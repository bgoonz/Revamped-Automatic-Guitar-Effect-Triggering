#AutonomusTriggeredGuitarEffectsPlatform

>Proprietaryimplementationofreal-timesubsequence-matchingdynamictimewarpingalgorithm


![presentation](./Documentation\SRProjectPresentation.gif)
![presentation](./SRProjectIIPresentation.gif)




TeamMembers:

##BryanGuner
>TeamLead&SystemDesign&/Validation


##HaleyScott
>Logistics,Integration&Documentation
##RalphQuinto
>PrincipleSoftwareDeveloper


PrimaryAdvisor:Dr.AmbroseAdegbege

May,2018



Acknowledgements

TheteamwouldliketothankDr.AmbroseAdegbegeforhisinputandenthusiasmtowardstacklingourdesignchallenges.WewouldalsolikethankDr.LarryPearlsteinforhisguidanceandsuggestionofDynamicTimeWarping.Inaddition,ourteamthanksMihirBegforhisconsultationonMIDItranscriptionandsuggestionofPureData.


















*****

Abstract

Inliveperformance,guitareffectpedalsareaversatileyetlimitingasset.Theyrequirepresenceofmindonthepartoftheperformer,andrestricttheperformertotheareaofthestageinwhichthepedalboardislocated.Theseconstraintslimittheperformancequalityandstagepresencebysplittingtheperformersfocus.Thisprojectproposesanautomaticsolutiontotherestrictionsthatguitareffectpedalspresent.Theperformerwillrecordtheprimaryperformancesintotheproposedsoftware,whichwillanalyzeandstorethesequentialfrequencies.Theperformerwillthenutilizethesoftwareduringasubsequentliveperformance,totriggereffectswhenprecedingfrequenciesoftheliveperformancearerecognizedagainstthefirstperformance.ThisplatformisrealizedthroughtheuseofPureData,aGUI(GraphicalUserInterface)foraudiomanipulationapplications.Ourteamhasdesignedanapplicationthatimplementsdynamictimewarping(DTW)inordertocomparethefirstperformancesagainsttheliveperformance.ThesystemcomparesMIDIdatausingthedynamictimewarpingdistancethreshold,opposedtotheEuclideandistancethreshold,makingitarobustapproachtomitigatingliveperformanceerror.





**Keywords:PureData,DynamicTimeWarping**

*****



Contents

Abstract........2

Introduction......5

Specifications...........7

1.0Chapter1:Background......8

1.1HowtheElectricGuitarWorks...........8

1.2HowthePedalBoardWorks...................8

1.3GuitarSignalAnalysis............9

1.4WhyTranscriptionMightNotBeImportant............10

2.0Chapter2:TheCountingMethod...12

2.1Concept.....12

2.1.1PrimaryRecording......12

2.1.2PrimaryAnalysis.....13

2.1.3LivePerformance........13

2.1.4LiveAnalysis.......13

2.1.5MethodExpansion...14

2.2PureDataEffects...........14

2.2.1DigitalEffectDesigninPureData..14

2.2.2DelayEffectinPureData........15

2.2.3FuzzEffectinPureData..15

2.2.4ReverbEffectinPureData..........16

2.2.5SpectralDelayEffectinPureData..17

3.0Chapter3:DynamicTimeWarpingMethod19

3.1.DynamicTimeWarping19

3.2WhyDynamicTimeWarpingisagoodchoiceforeffectstriggering...20

4.0Chapter4:PureDataandMethodImplementation.22

4.1Introduction....22

=4.2FirstApproach....22

4.3PythonImplementation...23

4.4PureDataDesign.....23

4.5DTWImplementationofJava......26

4.6DTWinPureData............29

5.0Chapter5:TestingandValidationExecution.........33

5.1MethodsofFunctionalityTesting.........33

5.2MethodsofSpecificationTesting.....35

5.3RealisticConstraintsTesting....36

6.0Chapter6:Conclusion....37

6.1CoreIntent........37

6.2ResultsAchieved..37

6.3ExpectationsandModifications.......38



Appendices:

AppendixA:ProjectOverview

AppendixB:ProjectManagement















Nomenclature

**Primaryperformances**:Guitarsignaldatarecordedathomeorinstudio,beforetheliveperformance

Introduction

Amusiciansdesiretodeliverinspiredliveperformanceswouldderivegreatutilityfromautomaticeffecttriggering.Thisconceptwillallowuserstofocusontheirperformanceratherthanthemanagementoftheirsoundeffects.Thevalueoftheautomatictriggeringarisesnotonlyinconvenience,butalsoineconomicexpense.Guitareffectpedalsarefarmorecostlythandigitaleffects,astherearesignificantlylesspointsoffailureindigitaleffects.Thisideaservestominimizedistractionsandcosttotheperformer,whilemaximizingtheexperienceofliveperformancefortheaudience.Thistaskwillbeachievedthroughthemethodsofdynamictimewarping,andfrequencycounting.

Dynamictimewarpingprovidesastrongersolutionfortheissueofperformanceerror.Thisalgorithmusesacomparisonmethodtofindthemostoptimalcorrelationbetweenliveperformanceandpre-recordedperformance.Here,theperformerwouldrecordfourprimaryperformances.Thedynamictimewarpingalgorithmisappliedusingthefirstperformanceagainsteachsubsequentperformance,producingasumofdistancesbetweenthesethreesetsofrecordings.Thissumisthenpaddedwithatolerance,andusedtocomparewiththesumofdistancesbetweenthefifth(live)performanceandthefirstprimaryperformance.Thismethodisappliedtosmallersectionsoftheperformance,providingtheknowledgeofwhentotriggerthedesiredeffect.Theimplementationofthisalgorithmprovestobehighlytoleranttoerror,butfairlycomplex.

Thealternateapproachistheimplementationofafrequencycountingalgorithm.Here,theuserwillonlyrecordoneprimaryperformance.Thisperformancewillbeusedtocreateasequenceoffrequencies,withagiventolerance.Thenumberofchangesinfrequencyarecountedandstored.Thefrequenciesfromtheliveperformancearethenverifiedagainstthepre-recordedfrequencies.Thenumberofchangesinfrequencyarestoredandcheckedagainstthepre-recordedsumofchanges.Oncetheseparatesumsfromeachperformanceareequal,theeffectwillbetriggered.Thismethodprovestobeextremelystraightforward,yetoffersfewsolutionstotheproblemofliveperformanceerror.

Throughoutthisreport,ourteampresentsthemethodsinstatedinourcurrentproject,aswellasthenextstepsinthedesignandmodificationprocess.Amorein-depthdescriptionofthetwoaforementionedmethodsisgiven,includingboththeprosandconsofeach.





















Specifications

Theprojectwasdesignedtomakeintegrationasseamlessaspossiblewithcurrentguitarsetups.Minimizingthedelaybetweentheperformanceandeffecttriggeringiscrucialsothatmusiciansarenotthrownoffbytheoffset.Basedontheresearchthatourteamhascompleted,thethresholdofoursystemwassettohaveamaximumtriggerlatencyof1second.Anythinglongerwouldbetoodisruptivetotheperformance.Anothercrucialspecificationishavingasamplingratetwiceaslargeasthefundamentalfrequenciesoftheguitar.Forelectricguitars,frequenciesrangefrom80Hztonearly400Hz.Thesoftwareutilizedinthisprojecthasadefaultsamplingrateof44,100Hz,whichismorethanenoughtosatisfytheNyquistcriteria.Inaddition,havingmanyguitareffectsoffersgreatversatilitytoaperformance.Thegrouphassetagoaltoimplementthreedifferentguitareffectsalongwiththecompletionofoursystem.

















1.0Chapter1:Background

1.1HowTheElectricGuitarWorks

Anelectricguitarisastringedinstrumentthatusesadevicecalledapickuptoelectrifyandsubsequentlyamplifytheguitarsignal.Themajorityofguitarpickupsarepermanentmagnetswrappedwithacoilofinsulatedwire.Thismeansthepickupinmostcasesisapassiveelementthatgeneratesavoltageviaelectromagneticinduction.Mostpickupshavegreatersensitivitytohigherfrequencynotes.Thisisbecausewithhigherfrequencycomeshigherstringvelocity,whichisinproportionwiththeoutputofthepickup.Anengineerwhoisnotmusicallyinclinedcanthinkofthepickupasatransducerfunctioningasaninductor.

1.2HowThePedalBoardWorks

Apedalboardisusuallycomprisedofapowersourceandamechanicalhousingforwhatarecalledstompboxes.Alsoknownaseffectpedals,stompboxesareactivatedbytheguitaristmanuallyduringaperformanceandproceedtoalterthecontentoftheguitarsignalinsomeform.SomemaybeassimpleasanEQsweepthatproducethefamouswahtonepopularizedbyartistssuchasJimiHendrixandSlash,whileothereffectslikedelaysandharmonizersaremorecomplexandcontainmultipleinternalstagesofeffectprocessing.Aguitaristspedalboardusuallyhousesanywherefromthreetotwentyeffectspedals,andcancontaintensofthousandsofdollarsworthofgear.Conventionally,theguitarisrunthroughtheeffectspedalsandthenintoanamplifier,howeverhigherqualityamplifiersmayprovideaneffectsloopthatallowsfordifferentconfigurationsofpreandposteffectamplification.Whilethismethodiseffectiveenoughtobethegotosetupforpracticallyallgiggingguitarists,therearesomefundamentallimitationstothisconfiguration.Thepedalboardisusuallypowerhungry,expensive,andstationary.

1.3GuitarSignalAnalysis

Inordertoaccuratelytriggereffectsbasedonanaudiosignal,onemustaccuratelycatalogthecontentofsaidsignal.Therearemanyapproachesusedintheanalysisofguitarsignals,butinordertomakesenseofthem,firstonemustunderstandwhatisistheyaremeasuring.Amusicalsignalcanbebrokenintodifferentmusicalfeaturerepresentations.Tosimplify,onecanassumethereareonlyfourfeaturescontainedinanysignal.Theguitarsignalwillcontaindynamicfeatures,thatis,thevolumeofdifferentnotesandsectionsofthemusicinrelationtotheothers.Itwillalsocontainpitchinformation,whichrevealsthefrequencyorthenotesbeingplayedatanygiventime.Further,onemayexaminethetimbre,whichrelatestothevariationfromidealintegermultiplesofthefundamentalfrequencythattheharmonicsofthenoteoccupy,aswellastheenergycontainedwithinthem.Finally,onemayrecordthetempoorspeedthattheperformanceandsubsectionsofitwereplayedat.Therearecountlessanalysistechniquesforeachmusicalfeatureandvariousschemestocombineandcomparethem.Below,wewilldescribeafewofthemorerobustanalyses,however,notethatourcurrentapproachusesaPureDataobjectnamedFiddlethatroughlyapproximatestheguitarsignalintoMIDIdatawhichonlyrecordspitchandtempo.Intermsofdynamics,onemaytakethemeansquaredamplitudeofsegmentsofasoundfile.Alternatively,onemaytrytoremovetheissueofvariablenoteamplitudeentirelybyclassifyingchordsinordertomaskoutthenoteshypothesizedtobeinagivensoundsegmentbyachordtemplatebitmask.Intermsofpitch,therearenearlycountlessalgorithmsbecausethisisthemostimportantfeaturetoaccuratelytranscribemusic.Almostalloftheseapproachesfallintoeithertimedomainanalysis(whichareusuallysomevariationofautocorrelation)orfrequencydomainanalysis(whichisoftenperformedontheresultsofaFFT(FastFourierTransform)).SomenotablevariationsareSNACAutocorrelation,(utilizedbythePdobjecthelmholtz)orChroma-vectororpitchclassprofiletranscription(bitmaskapproximationsoftheperformancebasedonpredefinedFFTspectrumcontentofvariouschords)orCepstrum(whichisthemagnitudespectrumofthelogofthemagnitudespectrumofawindowoftheaudiosignalwhichcanbeusedtodeterminethefrequencyofitspeaks).TimbrehasanalysistechniquessimilartoSpectralCentroid,however,itdoesnotmattermuchinthecontextoftranscriptionbecausetheonlyinformationitmayextrapolateiswhatinstrumentthepiecewasplayedon.Intermsoftempo,themostpromisingapproachtoaccuratetranscriptionistheseparationofthesignalintotransientandsteadystatesections.Thetransientsectionswouldthensignifynoteonsetandthereforeyieldtempo.Thisseparationwouldbeperformedbylookingatthevarianceofphaseinformationextrapolatedfromthefrequencybinsofthesignalswavelettransformationinrelationtothepreviousfewbins.Whiletheapproacheshereareonlyasmallfractionofallmaterialonthesubject,itturnsoutthateffecttriggeringdoesnotrequireaccuratetranscriptionoftheaudiofilebutratherconsistentrecordingandcomparisonfromoneperformancetoanother.

1.4WhyTranscriptionMightNotBeThatImportant

Preliminaryresearchonthisprojectfocusedonaccuratetranscriptiontechniquesthatcouldbeusedtocreateaprofileforeachsongthatwassoaccuratethatsubsequentperformancescouldbecomparedwithincertaintolerancesonanearlynote-for-notebasis.Eventually,itbecameapparentthatthismethodologywasfraughtwithpitfalls.Themostobviousisthattheseanalysistechniquesarecomplexandcomputationallyexpensive.Thenextchallengewasthatevenifthefeaturescouldbeaccuratelyextrapolated,howcouldtheybecombinedinrealtimeforacomparison?Itbecameapparentthatmosttechniquesdidnotaccountforlargedifferencesintempobetweenperformancesorevenmomentsofsilenceintheguitarsignal.Whilesolutionsfortheintegrationofsomeofthesetechniqueswereavailableorevenobvious,itappearedthattherewouldbemanychallengestoovercome.Further,evenifaccuratetranscriptionwereachievable,wouldthecomparisonfromoneperformancetoanotherbereliablewiththeintroductionofhumanerror?Takingintoaccountallofthefollowinghurdles,themosteconomicapproachwouldbetofocusonthecomparisonoftworecordingsratherthandecipheringtheinformationcontainedwithinthem.Thismentalityoneffecttriggeringhasproventobenotonlyimmeasurablymoreefficient,butalsomorerobust.Theefficiencyisgainedthroughthesimplisticspectralanalysisemployed,andtheobsolescenceofcombiningdifferentanalyses.Thestrengthofthisapproachisgainedinthefactthatfocusingonacomparisontechniqueallowsformuchmorevarianceinthetimingoftheperformancesofagivensong.Further,iftranscription-centriceffecttriggeringwasattheforefrontofconsideration,acomparisontechniquewouldstillbenecessary,andsofocusingoncomparisonfirstallowsforredesignandreconsiderationlateron.Theonlyconsiderationthismethodologyishinginguponisthatlessprecisetranscriptiontechniquesareconsistentlymisrepresentingtheinformationintheaudiosignalthesamewayeverytime.





2.0Chapter2:TheCountingMethod

2.1Concept

Theinitialmaterialresearchedbyeachteammembercontributedgreatlytotheoriginalconceptsofthedesignplan.Theteamstudiedvarioustopicsthatrelatetothisproject,includingspeechprocessingtechniques,gesturerecognitiontechniques,andaudiotranscriptiontechniques.Thismaterialallowedourteamtodefinethedesignrequirementsandfunctionalitiesofourproposedsystem.Theconceptinvolvesapre-recordedperformance,whichistobecomparedtotheliveperformance.Throughtheuserinterface,theperformerwillmarkthefirstontriggerpoint,andsubsequentlythefirstofftriggerpointfortheeffect.Withtheknowledgeofwhichpartofthesongtheperformerisplaying,thedevicewillbeabletotriggereffectsautomaticallyduringtheliveperformance.

2.1.1PrimaryRecording

Inordertocomparealiveperformance,thedevicewouldneedtobeabletoaccuratelycountandthresholdapre-recordedperformance.Ourteamproceededbydevelopinganalgorithmtoaccuratelyandpreciselymapthepre-recordedperformance.Aftercompletingresearchonwindowingandfrequencybins,weagreedthatastraightforwardapproachwouldbeapplied.Theguitarsignalwouldenterthecomputerasabitstream,andwouldbeanalyzedusingawindowedFastFourierTransform(FFT).Thisdatadescribesthesonginasequentialfrequencyrepresentation.Essentially,thisinformationdefinesthesongintermsofthenotesbeingplayed,aseachnoterepresentsauniquefrequency.



2.1.2PrimaryAnalysis

Inordertomakesenseofthisrecordedperformancemap,ourteamconceivedtheideaofanalgorithmtorecognizethechangeinfrequencies,andrecordthem.Thesystemwouldonlyregisterachangeinfrequencyshouldthechangeexceedtheinstatedtolerance.Thesystemwouldrecordthefirstvaluethatexceedsthistolerance,subsequentlyproducingalistofnotesintheordertheyareplayed.Theuserwouldmanuallyselectthefirstontriggerpointbyenteringthenumericvalueofhowmanynotespreceedthetriggerpoint.Thissystemwouldtriggeraneffectifandonlyifthenumberofthespecifiednoteenteredbytheuserisequaltothenumberofnotesrecognizedintheliveperformance.

2.1.3LiveRecording

Theliveperformancepresentsaninterestingobstacleforthisimplementation.Notonlydotheexactnumberofnotesneedtobemonitored,butalsotheaccuracyofthenotes.Here,theperformerwouldplaythesamesongthatwaspre-recorded.Thenoteswouldagainenterintothecomputerasabitsteam,andwouldbeanalyzedinasimilarmannerastheprimaryrecording.Here,thefrequenciesaresequentiallyrecordedeverytimeachangegreaterthanthepreviousnotestoleranceoccurs.

2.1.4PrimaryandLiveComparison

Theanalysisoftheliveperformanceinvolvesthecomparisonofthetworecordings.Iftheinitialliveperformancefrequencymatchestheinitialrecordedfrequencywithinthegiventolerance,a1,orbangwillberecorded.Thispatterncontinues,markinga1orbangeverytimeafrequencyoutputsamatch.These1srecordedfromtheliveperformancearecomparedtothesumofthenumberoffrequenciesbeforethetriggerpointmarkedbytheuser.Whenthesetwonumbersareequal,theeffectwilltrigger.

2.1.5MethodExpansion

Thisprocesscanbeexpandedtoaccountfortheofftriggerpoints,aswellasmultipleeffectsthroughoutthesong.Thesameconceptwouldbeusedtomarkdifferentpointsintheprimaryrecording,insteadofsimplytheinitialontrigger.Themaindrawbackofthismethodisthelackoftolerancetoerror.Thisproblemcouldbeaddressedwithasimplesolution,onewouldfirstneedtomodifythePdpatchtohavesubpatchesforall12temperedscalenotesinsteadofjustoneofthem.Ifonenoteismissed,butthenextthreearecorrect,thesystemwillfillina1orbanginplaceofthemissednote.

2.2PureDataEffects

PureData(Pd)isthesoftwareplatformourteamutilizedtodesignasimplifiedcountingmethoddescribedinsection2.1.Pdisavisualprogramminglanguageandenvironmentforcreatinginteractivecomputerandmultimediaworks.Itsmostpromisingattributesareitsvisualsimplicityanditsabilitiestoprocessaudioinrealtime.

2.2.1DigitalEffectDesigninPureData

Thevisualinterfaceprovidedbypuredatamakesthecreationofdigitaleffectsrelativelysimple.Basiceffectscanbedesignedsolelythroughtheuseofobjectblocks.Objectblockscancontainvariouscontrols,suchasADC,DAC,readsignal,writesignal,orevensimplenumericinputs.Usingthesecontrols,ourteamcreatedthreedifferentdigitaleffects.

2.2.2DelayEffectinPureData

Ourteamdesignedaguitardelayeffecttoplaybackthedelayedsignalintotherecording.Thiseffectcreatesthesoundofarepeating,decayingecho.First,theguitarsignalentersanADCobject,andcontinuestoadelaywriteblockwhichallocatesmemoryforadelaylineandwritestheguitarsignalintoit.Thesignalisthenattenuatedbyafactorof.6inordertocreatethedelayedsound.Next,thesignalisreadfromthedelaylineusingadelayreadblock.Finally,thedelayedguitarsignalpassesthroughaDACobject,whichallowsfortheproductionoftheaudiooutput.

![](Final%20Report%20SP2_files/image002.gif)

*Figure1:DelayEffectPd*

2.2.3FuzzEffectinPureData

Ourteamdesignedaguitarfuzzeffecttoimplementadistortioneffectontheguitarsignal.Thiseffectcreatesthesoundofamoreprocessedorartificialguitar.Here,theguitarsignalispassedthroughanADCobject,andcontinuesontoagaintobemultipliedbyafactorof40.Next,thesignalispassedthroughaclipobject,whichrestrictsthesignaltoliebetweentwolimits,-0.5and.05.ThesignalisfinallyconvertedbacktoananalogsignalthroughtheDACobject.

![](Final%20Report%20SP2_files/image003.gif)

*Figure2:FuzzEffectPd*

2.2.4ReverbEffectinPureData

Ourteamdesignedareverbguitareffect,whichmirrorsalargenumberofreflectionsofthesignaltobuildupandthendecay.TheguitarsignalisfirstsentthroughanADCobject,andsubsequentlysenttoafreeverb\~blockwhichusestheSchroederandMoorermodelforreverb.TheguitarsignalisfinallysenttobothoutputsoftheDACobject,whichallowsfortheproductionofthereverberatedsound.Therearemanycontrolsassociatedwiththereverbthatallowuserstomanipulatethesoundoftheeffect.Theroomsizeblockallowstheusertoslidefromarangeof0to1,creatingasmallerorlargersimulatedroomsize.Thedampingblockslidesfrom0to1,affectingthedampnessoftheobjectswithinthesimulatedroom.Thewettodryslidercontrolstheamountofreverbappliedtothedry,oruntouchedsignal.Thefreezetoggleallowstheusertograbtherealtimetailofthereverbandapplythesoundcontinuously.Thebypasstoggleallowstheusertoturntheeffectoff,andpassthroughacompletelydryguitarsignal.Thesetogglesserveasaconvenientaidthroughoutthetestingprocess.

![](Final%20Report%20SP2_files/image004.gif)

*Figure3:ReverbEffectPd*

2.2.5SpectralDelayEffectinPureData

Ourteamdesignedaspectraldelayeffecttoscattertheoriginalguitarsound,allowingonetohearallthepartials(harmonics)ringingatdifferenttimes.Thiseffectcreatesthesoundofarepeated,echoedguitarsignal.Inthispatch,thefftoftheincomingguitarsignaliscalculatedandusedtocutthesoundintoverythinfrequencybands.Adifferent,usercontrolleddelayisthenappliedtoeachofthesebandsbeforeresynthesis.Ifthelengthofthedelaylinesvarygreatlyfromonefrequencybandtoanother,theringingeffectofeachharmonicbecomesmoreapparent.Here,theguitarsignalispassedthroughanADCobject,andcontinuesontoaPdblockcontainingusercontrolledsliders.Eachsliderallowstheusertospecifytheamountofdelay,feedback,andgaininstated.Theuserisalsoabletocontrolthecutoffofthelowpassfilterapplied,aswellashowwetordrythesignalshouldbe.Next,thesignalispassedthroughanequalpowercrossfadeobject,whichallowstheoverallvolumetobemaintainedthroughthecrossfade.ThesignalisfinallyconvertedbacktoananalogsignalthroughtheDACobject.

![](Final%20Report%20SP2_files/image005.gif)

*Figure4:SpectralDelayEffectPd*

**

**

**

**

**

**

**

**

**

**

**

**

**

**

3.0Chapter3:DynamicTimeWarping

3.1DynamicTimeWarping(DTW)
DynamicTimeWarpingisanalgorithmforthemeasurementofsimilaritybetweentwotemporalsequences,whichmayvaryinspeed.Thealgorithmcalculatesanoptimalmatchbetweentwogivensequencesintheformofadistancethatisthesumoflocalizedcostfunctions.Theprocesscanbethoughtofconceptuallyasarrangingthetwosequencesonthesidesofagrid.Eachcellwithinthegridwillbefilledinwithadistancemeasurecomparingthecorrespondingelementsofthetwosequences.Thismeasurecanbejustsubtractionofonesequencefromanother,butmoreofteneachcelliscomputedbymoresymmetricmeasureslikethesquareofthedifference.Inordertofindthebestpaththroughthegrid,wesearchforapaththatminimizesthetotaldistancebetweenthem.Theprocedureforfindinganoveralldistancemeasureistofindallthepossibleroutesthroughthegridandcalculatethetotaldistanceforeach.Notethatbecausewearelookingforaminimumlengthpath,eachroutestotaldistanceistheminimumofthesumofdistancesbetweenindividualelementsonthepathdividedbythesumofthewarpingfunction.MostinstancesoftheDTWalgorithmsharecommonoptimizations.Themostobviousisknownasthemonotoniccondition,whichsimplystatedistherulethatthepathwillnotturnbackonitselfandthereforetheindexesofthematrixmusteitherremainthesameorincreaseduringeachsubsequentiteration.Further,examiningtheliteraldefinitionofapath,theelementsselectedmusttosomedegreebordereachother,andsotheindexesmayonlyincreaseby1fromeachelementofthepathtothenext.AnothercommonalityinDTWalgorithmsistheboundarycondition,whichrequiresthatthepathmustbeginattheintersectionofeachsequencesrespectivefirstelementsandendontheintersectionofeachsequencesrespectivelastelements.Someotheroptimizationsarecommonbutnotintegral,forexample,theadjustmentwindowconditionpostulatesoptimizationstokeepthepathfromwanderingtoofarfromadiagonalthroughthegrid,whichwhilesometimesacriticalflaw,usuallyresultsinhugecomputationalefficiencygains.Anothersuchoptimizationisaslopeconstraintwhichensuresthatparticularlylongsequencesarentmatchedwithshortsequences,butthiscanresultininaccuraciesifoneofthesignalswasparticularlydilatedorcontractedintime.Sincethistechniquehasbeenattheforefrontofcomparingtemporalsignalssincethe1980s,thelistofvariationsontheclassicalgorithmisextensive.
3.2WhyDynamicTimeWarpingisaGoodChoiceforEffectTriggering
Inthemoresimplisticcountingapproachemployed,theguitaristisrequiredtoreplicatetheperformancebothfaithfullyintimeandinaccuracy.Smallinaccuraciesineithermetriccouldeasilycausethetriggeringschemetomiscountoutofourpredeterminedrange.DTWisasuitablealternativebecauseitisrelativelyinsensitivetotime-scalecontractionordilationineitherthedatabaseorquerysignals.Further,eveniftheperformermakesnumerousmistakesintheperformance,aslongasthesectionistheclosestmatchtothedatabasesequencetheprogramwillconsideritamatch.Thisrobustalgorithmcanbeproventimeinandtimeoutbyanyspeechdictationsoftwarewherethetolerancefordifferencebetweenthetwosignalsisastounding.Moreover,whenconsideringdifferentmusicalfeaturemeasures,themethodsofcomparisondifferdependingonthemusicalfeaturewithsomenecessitatingconvolutedapplicationssuchasneuralnetworks.Evenmoredemandingistheneedtocombinedifferentfeaturesinausefulway.DynamicTimeWarpingworksasanaccuratecomparisonbetweenfeaturessolongastheyarestructuredintime(eveniftheinformationtheyconveyisinfrequency).Inaddition,becausethefeaturesconsideredforaDTWalgorithmaresetintime,ifoneweretochoosetotrackmultiplefeaturesconcurrently,(nolongernecessaryinthecontextofDTW)itwouldlikelybesimpletocorrelatedetectedmatchesbetweendifferentfeaturesbyasimpletimingthreshold.Followingthistrainofthought,onecouldsettheeffectsplatformtotriggeronorshortlyaftertheoccurrenceofthesecondarydetection,allowingthesystemtovirtuallyguaranteetheabsenceofpreemptivetriggering.Asiftheseargumentswerenotpersuasiveenough,anotherbenefitofDTWisthatifthesystemweretorequiremultipledatabaseperformances,thensectionspecificDTW-distancethresholdscouldbesetforeachpartofasongastoensureaccuracyformultipletriggereventsordifferenteffectstriggeredondifferentinstancesofspecificrecurringpartsofasong.Mostimportantly,becauseoftheextensiveresourcesalreadyinvestedintotheDTWalgorithm,thereisawealthofoptimizationoptionsandconfigurationsthatenablecomputationallyefficientapproachestobeselectedbasedontheneedsofaspecificapplication.















4.0Chapter4Implementation

4.1Introduction
Whendesigningthesystemfortheproject,thegrouplearnedthatthereweremanydifferentmethodstoapproachtheproblem.Hardware,softwareplatforms,andanalysismethodswerecomponentsthathadtobecarefullychosentomeetthefulldemandsofthesystem.Whendesigningthestructurefortheproject,thegroupwentthroughmanyapproachesbeforesettlingonthefinalarchitecture.Thevariouscriterionthatneededtobemetentailedchallengessuchasmobility,robustness,speed,andusability.
4.2FirstApproach
Thefirstapproachconsistedofusingaphysicalcomponentthatwouldoffsetandamplifytheguitarsignal,anexternalADC,andaraspberrypi.Thephysicalcomponentwasrequiredbecausethesignalofanelectricguitarfellwithinthemillivoltrange,andtheexternalADCoperatedwithaminimumof1volt.SignalscomingtotheelectricguitarwouldbefedthroughthecomponentandthenontotheADC.Theraspberrypiwouldthenreadthediscretizedsignalthroughapythonprogram.Whenthesystemdetectsatriggerevent,itwouldoutputasignalthroughthebuiltinDACandtriggeraphysicalguitarpedal.Thisapproachwasdismissedduetotheunnecessaryuseofamicrocontrollerandphysicaleffectpedals.Toperformsignalanalysis,itisimportanttouseaCPUwithafastenoughprocessingspeed.Althoughtheraspberrypihasoneofthefastestprocessingspeedsonthemarket,itstillfallsshorttothespeedalaptopcanprovide.

4.3PythonImplementation
Forthenextapproachofthesystem,alaptopandaquarter-inchtoUSBadapterwastobeusedinlieuoftheraspberrypiandexternalcomponents.Python,duetothelargenumberofavailablelibraries,waschosenforthisimplementation.Numpy,Scipy,andMatplotlib,aremathematicallibrariesthatallowPythontoperformMATLABlikeoperations.TotestthespeedatwhichPythonperformedanalysisonalivesignal,atestmodulewascreatedtoreadininputfromamicrophone.Usingtheaforementioneddatasciencelibraries,variousaudioanalysistechniqueswereperformedonthesignal.Theincomingsignalswerefirststoredinarraysofsize4096samples.Thedatawasthenconvertedfrombytestointegerssothatoperationscouldbeperformedonthesignal.Tovisualizetheoperations,weplottedthelivesignal,therealtimeFastFouriertransform,andthezerocrossingsonthesamewindow.Whilerunningtheprogram,thegroupnoticedmanyissues,thefirstbeingthelatencybetweentheplots.ThiswastobeexpectedduetothesequentialnatureofPython.Anotherpitfalltothisapproachwasthelowresolutionofthesignal.Anapproachtoamendthisissuewastoincreasethesamplesize.However,oncethesamplesizewasincreased,therewasanincreaseddropintheframespersecondoftheplot.Allinall,whilepythonwasabletoperformanalysisonthesignal,theteamdidnotviewthissystemtobeanadequateapproach.
4.4PureDataDesign
PureData(pd)isanopensourcevisualprogramminglanguagedesignedforaudioandmusicmanipulations.Itwasfirstreleasedinthemid1990sbyMillerPuckettewithsimpleaudiomanipulationobjects.Sincethen,manyiterationsoftheprogramhavereleasedalongwithdozensofcomplexmodulescontributedbyopensourceusers.Withitsmodulardesign,userscancreatetheirownpuredataobjectsorexternalswiththeprogramminglanguageoftheirchoice.PureDatawaschosenastheplatformtobuildthesystemonbecauseofthesimplevisualizationofdataflow,processingcapabilities,aswellasthelargelibraryofpuredataobjects.

AblockdiagramofthegroupsfirstimplementationcanbeseenonFigure5below.TheapproachforthebasicsystemwastoreadsignalscomingfromthequarterinchtoUSBadapterusingtheADCobjectofPd.Itwasdecidedthatdigitaleffectswouldbeusedinlieuofaphysicalguitarpedalasthecostswereabovetheprojectbudget.Alowpassfilterisappliedtothesignalbecausethefundamentalfrequenciesofanelectricguitardonotextendbeyond400Hz.Thesignalisthenfedthroughthefiddleobject.FiddleconvertsthepitchoftheaudiosignaltoMIDI.Thisisausefulfeatureasitallowstheeaseuseofmathematicaloperations.Usingcomparatoroperators,thesystemcancounttheinstancesofaspecificnoteandtriggeraneffectonceitreachesapredefinedthreshold.Intestingtheprogram,MaryHadaLittleLambwastestedasitdoesnotcontainanycomplexchords.TheMIDIvalueof76wasverifiedwithcomparators.Acounterwasbuiltandattachedtocountthenumberoftimesthecomparatorsreturnedatruestatement.Oncethecounthadreachedavalueof12,thedelayeffectwastriggered.Thiswasaccomplishedbyusingthemosesobject.Mosesactslikeanifelsestatement.Iftheincomingvalueisbelowthethreshold,itsendsatriggertotheleft,ordryoutput.Whenthevalueisgreaterthanorequaltothethreshold,itsendsatriggertotheright,oreffectoutput.Inthedesign,whenthevalueisbelowthethreshold,theinputgoesstraighttotheDAC.Whenthetriggerconditionsaremet,thesignalisfirstfedthroughthedelayeffectbeforethesignalispassedthroughtheDAC.UpontestingoursystemwithMaryHadaLittleLamb,wewereabletosuccessfullytriggertheguitareffect.![](Final%20Report%20SP2_files/image006.jpg)

*Figure6:BlockDiagramofBasicTriggerPDPatch*

Afterevaluatingthetestresults,thegroupnoticedseveralissueswiththeimplementation.Thefirstofwhichwasthatthesystemwassensitivetoperformancespeedandarticulation.Whenthetheuserarticulatedanotefortoolong,thecounterblockwouldcontinuetocountupeventhoughthenotewasplayedonlyonce.Thisleadtoinconsistenciesincountaccuracy.Intestingoursystem,thegroupfoundthatthesystemwouldtriggeratthecorrecttiming60%ofthetime.Oneofthegoalsofthisprojectwasthatthesystemshouldhandleupto10noteonsetspersecond.Currently,thesystemiscapableofhandlingupto10notesalbeitthereareinconsistenciesduetosensitivityissues.Toresolvethisissue,thegroupplansonnarrowingtherangeofMIDIvaluestocheckfor.Anotherissuewiththisimplementationisthatsimilarsongsmaytriggeraneffectconfiguredforaspecificsong.Forexample,iftheprogramisconfiguredforMaryHadaLittleLamb,playingLondonBridgeisFallingDownmaytriggerthesystem.ThisisduetothefactthatLondonBridgeisFallingDowncontainsmanyofthesamenotesasMaryHadaLittleLamb.Onefinalissueisthatthissystemisgearedtowardshandling1noteatatimeasopposedtochords.ThereasonforthisisthatthefiddleobjectlooksatthehighestpeakwhenlookingattheFFTofthesignal.Whenfiddlereadsinachord,itfindsthehighestpeakofthesignalinthefrequencydomainandusesthatpointtoconverttoMIDI.ThegroupdecidedtoresolvetheseissueswiththeimplementationofDynamicTimeWarping.

4.5DynamicTimeWarpingImplementation

InordertogainabetterunderstandingofDynamicTimeWarping,thegroupcreateditsownimplementationofDTWbasedonasourcefoundintheresearchphase.Thewaytheproposedsystemworksisthatthesystemtakesinthepointsofstoredsignalandplacesthemontheleftmostcolumn.Thepointsoftheincomingsignalbeingcomparedtoarethenplacedonthebottommostrow.Amatrixisthengeneratedbasedonthesymmetricaldistanceofthe2signals.Thesymmetricaldistanceisthedifferencesquaredofthepointsofthetwosignals.AnexamplecanbeseeninFigure6below.

![](Final%20Report%20SP2_files/image007.gif)

*Figure7:DynamicTimeWarping*

Foreachcell,thecostofarrivingatthecellfromthebottom,left,andbottom-leftiscalculated.Onthepoint(2,2)ofFigure7below,itcosts2unitstoarrivefromthebottomcellbecausethebottomcellslowestvalueplusthecurrentcellvalueis2.Itcosts1toarrivefromtheleftbecause2+0=2.Itcosts1toarrivefromthebottomleftbecause1+()\*0=1.Aftercalculatingthecostsforeachcell,theleastcostpathcanbedetermined.Tofindtheleastcostpath,onemustmakethreeassumptions.Thefirstisthatthepathalwaysbeginsatpoint(1,1)andendattheupperrightmostcell.Secondly,itisassumedthattheleastcostpathshouldliealongthediagonalofthematrix,sodiagonalmovementshouldbefavoredoverlateralmovement.Thegrouphandledthisintheimplementationbyreducingthecostofdiagonalmovementby50%.Finally,thethirdassumptionisthatbecausetimemovesforward,oneshouldnevermovebackwardstofindtheleastcostpath.Calculatingtheleastcostpathinvolvesstartingattheupperrightmostcellandworkingbackwardstothestartingcell.Thepathchosenshouldbethecellwiththelowestcostofarrival.

*![](Final%20Report%20SP2_files/image008.gif)*

*Figure8:CostArrivalPerCell*

Thejavaimplementationofthisapproachandthecorrespondingcodecanbeseenintheappendixbelow.Figure8belowdisplaysthetwoexampletestcasesthatwereprocessedintothesystemandtested.

![](Final%20Report%20SP2_files/image009.gif)



*Figure9:SignalsTestedforDTWImplementation*

Thefirstscenariotestedinvolvedtwoidenticalsignalsbeingcomparedagainsteachother.Sincethepointsbeingcheckedareexactlythesame,aleastcostpathofzerocanbeexpected.Thesecondtestscenarioinvolvedtwodifferentsignalsofthesamelength.Thistestcaseshouldresultinanon-zerovalue.Manuallycalculatingtheleastcostpathofthistestcase,thegroupdeterminedaleastcostpathvalueof5.Afterrunningtheprogram,thesystemprintedtheresultsshowninFigure9below.

![](Final%20Report%20SP2_files/image010.gif)

*Figure10:JavaImplementationResults*

Comparingtheactualresultswiththeexpected,itcanbeseenthatthegroupwassuccessfulintheimplementationofdynamictimewarping.



4.6DTWinPureData

SincePureDatadoesnothaveadynamictimewarpingpuredataobject,thegrouphadtocreateitsown.ThetoolsneededtoaccomplishthistaskwasCodeBlocks(IDE)andthepuredatasourcecode.Cwastheprogramminglanguageofchoiceasitwastheindustrystandard.Thebasisalgorithmforthesystemwouldconsistofalearningphaseandalivephase.Inthelearningphase,theuserwouldfeedsubsignalsofasongandthesystemwouldcalculatethedynamictimewarpingleastcostpathbetweenthefirstsubsignalagainstallothersubsignals.Inthelivephase,thesystemwouldlistentoanincomingsignal,fiddlemididata,andperformdynamictimewarpingontheliveagainstoneoftherecordedsignals.Figure10belowdisplaysthepdpatchcreatedinordertorecordandstoresubsignals.

![](Final%20Report%20SP2_files/image011.gif)

*Figure11:PDPatchtoSaveSubSignalRecordings*

ThefirststepwastoincludethepdheaderfileintoourCodeBlocksprojectfile.Astructwasgeneratedasitservedastheobjectinstanceofourexternal.Wedefinedthreeinlets,Abangand2floatinlets.Thebanginletspurposewastocalculatetheleastcostpathofthesignalintherecordingphase.Thefirstfloatinletspurposeistoreceivetheincomingsignalfromtheadcobject.PureDatahasasamplerateof44,100Hzandthefiddleobjectproducesamidivaluebasedonthemostrecent1024samples.Effectively,ourobjectshouldbeabletoreadinavalueevery22ms.Thesecondfloatinletspurposeistoreceivethefloatvaluethatdefinesdelaytriggeringtime.Anoutletwasalsodefinedsothatitwouldsendoutabangwhenamatchbetweenthesignalworks.

Thefirstphaseofoursystemisthelearningphase.Whenthebanginletispressed,thesystemreadsin4recordedsignaldatafilesfromthepathoftheproject.Input1wasdefinedasthereferencesignal,meaningitistheinputthatwillbeusedtocompareallothersignals.Thesystemwassetsothatitcouldhandledataofsize300samples.Calculatingthedynamictimewarpingleastcostpath,followsasimilarapproachastothegroupsjavaimplementation.Theonlymaindifferenceisthatitcannotcomparesignalsofdifferentsizes.Oncetheleastcostpathhasbeencalculated3timesbetweeninput1andtheotherrecordedsignals,theaverageleastcostpathiscalculated.Thiswillserveasthethresholdtocomparetheincomingsignalto.

Duringthelivephaseofthesystem,theincomingsignalisreadthroughthefirstfloatinlet.Whenaninputisdetected,theincomingfloatvalue,isstoredinatemparray.Thesystemthenchecksifthearrayisfilledwithvalues.Ifitisnotfilled,thesystemchangestheindexandwaitsforanotherfloatinputvalue.Ifitisfilled,thesystemperformsdynamictimewarpingagainstthesignalstoredinthetemparrayandinput1.Shouldtheleastcostpathbeequalorlesstotheaverageleastcostpath,thesystemoutputsabangsignalingamatch.Thatwouldtheninturntriggertheguitareffect.Ifthelcpvalueisnotlessthanorequaltotheavglcpvalue,thenthesystemwaitsforanotherinput.Whentheinputisreceived,thetemparrayshiftsallofitsvaluesothatitsoldestvalueisremovedandnewvalueisstored.Thenewtemparrayisthenonceagaincomparedagainstthestoredsignal.Thisprocessrepeatsuntilamatchisdetectedoriftheuserexitstheprogram.

ThecompletedpuredataobjectcanbeseeninFigure12below.Inordertotestthesystem,thegroupcreatedapuredatapatchthatwouldactivatethereverbeffectwhenasignalmatchwasdetected.Figure13belowdisplaystheactualpatchusedfortesting.Thegroupfoundthatthesystemwouldtriggerverypreciselywhenindividualnotes.Toverifythatthegroupmettheoriginalspecificationoflessthan1secondlatency,atimerwasaddedtotheprogramtorecordandprintthetime(seconds)ittooktoperformdynamictimewarping.Itwasobservedthattheactualcalculationonlytook1-2milliseconds.Whenchordswereusedtotestthesystem,thetriggeringproducedveryinconsistentresults.Inordertoalleviatethisissue,thethresholdwaschangedsothattheeffectwouldbeplayedifthecalculatedleastcostpathwaslessthanorwithinplusfivepercentoftheoriginalthreshold.Throughthesetestings,thegroupwasabletofinetunetheobjectuntilresultsmetthegroupssatisfaction.

![](Final%20Report%20SP2_files/image012.gif)

*Figure12:GeneratedDynamicTimeWarpingPDObject*

**

*![](Final%20Report%20SP2_files/image013.gif)*

*Figure12:PDPatchtotestdynamicTWobject*

5.0Chapter5:TestingandValidationExecution

**

5.1MethodsofFunctionalityTesting

Whenthegroupfirststartedworkingonthisproject,theteamlaidoutprojectgoalstoaccomplishbytheendofthesecondsemesterofsenioryear.Theteamwantedtodevelopasoftwareplatformtoanalyzeasequenceofnotewheninstructed.Thesystemshouldtriggeronadesignatedinstancethatoccursmultipletimesthroughoutasong.Latencyshouldalsobeminimizedto1secastonotdisrupttheperformer.Inaddition,thesystemmustprocesssequencesupto10noteonsetspersecond.

Inordertovalidatethatthegroupwassuccessfulincreatingasoftwareplatformthatwouldanalyzeasequenceofnotesandtriggerguitareffectswheninstructed,thedevelopedavarietyoftests.Theplanwastofeedindifferenttypesofguitarsubsequences.Theseincludesequencesofsinglenotesandsequencesofchords.Thetestswouldbedeemedsuccessfulifthesystemisabletotriggerguitareffectafterthesequenceinstanceisplayed.

Thegroupalsoneededtotestifthesystemcouldtriggeronadesignatedinstanceratherthanjustatthefirstinstance.Theplantotestthiswastouseasubsequencethatwouldbeplayedmultipletimethroughoutasong.Verifyingthelatencybetweensignaldetectionandtriggeringwastrivial.ThegroupusedtheClibrarytime.hinordertorecordthesystemclocktimejustbeforethedynamictimewarpingfunctioniscalledandonceagainafterthetriggeringoccurs.Takingthedifferencebetweenthetworecordingswouldresultinthetotallatencyofsignaldetectionandlatency.Determiningifthesystemisabletohandle10noteonsetpersecondwasalsosimple.Thegroupwouldtakethesamplerateofpd,whichwas44,100,anddivideitbythenumberofsamplesfiddletakesin.

Thefirstsequencetestedwasariff,whichisessentiallyasequenceconsistingofsinglenotes.Thesequencewasfrom*Superstition*byStevieWonder.Firsttheteamrecordedfoursequencesoftheriff,andtheaveragedtwleastcostpathisthencalculatedbetweenthefirstrecordedsignalandtheotherthreesignals.Theaveragedtwleastcostpathisthensetasthethresholdofthesystem.ThedynamicTWobjectthenlistenedtotheincomingguitarsignal.Onceenoughdatahadbeenreceived,thesystembegancalculatingtheleastcostpathoftheincomingsignalagainstssignaloneoftherecordedsignals.Bryan,theperformerforthistest,playedthespecifiedriff.Itwasapparentthatthesystemtriggeredtheguitareffectjustastheriffsequencehadfinishedbeingplayed.Thisprovedsuccessfulfunctionalityofoursystemforsequenceswithonenoteoccuringatatime.

Thenextsequencetestedcontainedchords.Thesameprocessastheriffwasusedinordertovalidatethesystem.Onthefirstplaythroughofthesequence,thesystemwasnotabletodetectthechordsequence.Observingtheconsoleoutputofthesystem,itwasnotedthatthecalculateddtwleastcostpathvalueofthelivesequencecameveryclosetowithintenpercentofthethresholdsetbysystem.Thegrouptriedonceagaintotestthechordsequence,butonthistestinstanceBryan,playedataslightlyslowerrateandthesystemwasabletodetectthechordsequence.Itwasobservedthatthesystemismoresensitivetochordsandtheperformerneedstoplaymoreconsistentlyandbeinlinewiththeperformanceoftherecordedsequences.Thissensitivitytotheperformersattackontheguitarstringscanbemitigatedbyamoreconsistentperformancebytheperformer.

5.2MethodsofSpecificationTesting

Tovalidateifthesystemcouldhandletriggeringeffectatadesignatedinstance,thegroupchosetousethesong*Superstition*becauseitcontainedsequencesthatoccuredfrequently.Repeatingtheprocessoftestingasthechordandriffsequence,thegroupfoundthatthesystemwasnotabletotriggeronthedesignatedinstance.Thesystemwasonlyabletodetectthesequenceatthefirstinstance,ratherthanatthedesignatedinstance.Thereasonforthiswasbecausethesystemwasnotbuilttohandlethisfeature.Thegroup,forthemajorityofthesemester,washeavilyinvolvedingettingthedetectionofthesequencetofunction.Oncethegroupaccomplishedthistask,theteamattemptedtoincorporatethisfeatureintotheprojectbutultimatelyduetotimeconstraints,thefeaturewasnotincorporated.

Aspreviouslymentioned,determiningthelatencywastrivialwiththeuseofthetime.hlibrary.Toreiterate,thegrouprecordedthesystemclockrightbeforethedynamictimewarpingfunctionwascalledandonceagainafterthetriggeringoftheeffectoccurred.Thedifferencebetweenthetwosignals,shouldresultinthelatencyofsignaldetectionandtriggering.Thelatencywasoutputtedtoconsoleanditwasobservedthatthelatencywasbetween.001to.002secondswhichwasfarbelowtheprojectspecification.Toverifythe10noteonsetpersecondspecification,weutilizedthepuredatasamplingfrequencyanddivideditbythenumberofsamplesrequiredbyfiddle,whichwas1024.Thisresultsinavalueofapproximately43-44notesplayedpersecond.

5.3RealisticConstraintsTesting

Inorderforthesystemtobemarketable,noneoftheeffectswecreatecanbeallowedtoamplifyasignaltoamplitudesthatmightbehazardoustotheamplificationcircuitry.Itisforthisreasonthatforexample,inourFuzzeffect,theboundsoftheclipareverytight.Anotherconstraintisthevolumeoftheoutput,whichisdesiredtobebetween20dBand65dBhoweverthisisaconstraintontheamplificationratherthanthetriggeringplatform.Further,oursystemrequiresacomputerrunningawindowsoperatingsystem,limitingthesituationsinwhichitcanbeutilized.Anotherconstraintisthesystemscurrentinabilitytointerfacewithanalogguitarpedalsinthecurrentstateofdevelopment.Thisplatformisconstrainedbythetriggerlatencyof2msandtheminimumnoteonsetseparationwhichis43notespersecond,bothofwhicharewellwithintheworkablerangethatourteamestablishedattheonsetofthisproject.Theseconstraintsarebasedontheassumptionofacomputerwithmorethanampleprocessingspeedwhichmaybecomeaconstraintifausercomputerdoesnothaveadequateprocessingpower.Finally,thesystemisconstrainedbyatradeoffbetweenquerysequencelengthandcomputationalspeed,alloftheparametersprovidedabovearebasedontheassumptionofthreesecondlongtriggersequencesandwindowsof300featuresamplesoftheliveinputshiftedbyonefeaturesampleperiteration.







6.0Chapter6:Conclusion

6.1CoreIntent

Thisprojectservestoautomatetheprocessofguitareffecttriggering.Inordertosimplifytasksfortheperformer,ourdevicerecordstheeffecttriggerpoints,andexecutestheprocedurewithnomanualinterjection.Thedesignstreamlinesthedutiesoftheperformer,andcreatesamoreinteractiveexperienceforanypotentialaudience.Ourteamscurrentmodelsuccessfullyachievesthetaskofautomaticontriggering.ThemethodologyinvolvestheDTWprocessdefinedinChapter3.3.



6.2ResultsAchieved

Thissemester,theteamgeneratedtangibleresultssuchasafunctionalprototypeofthefinaldesign,aswellasthecreationofpuredatadigitaleffects.Beforesettlingonthefinalarchitecture,therewereseveralarchitecturesthatweretested.TheinitialapproachofthesystemcalledfortheuseoftheRaspberryPiandanexternalguitarpedal.Thisapproachwasquicklydismissedastheprocessingspeedoftheraspberrypiwasinsufficient.Furthermore,thephysicalguitarpedalsthatcontainedtherequiredinterfacewerebeyondtheprojectbudget.Realizingthesedrawbacks,theteamreplacedtheraspberrypiwithalaptop,andoptedtousedigitaleffectsoverphysicaleffects.ThisiterationcalledfortheuseofPythonandseveralexternallibraries.Pythoniscapableofhandlingvariousdigitalsignalprocessingtechniques,butthedataresolutionisinsufficient.ThecurrentiterationofthesystemcalledfortheusePureDatainlieuofPython.Acomplexprototypeofthesystemwasgeneratedandtested.SinglenotescanbereadusingthefiddleobjectofPureData.Usingvariouscomparators,theteamwasabletosetatriggertoactivateaneffectifallconditionsweremet.ThesongSuperstitionbyStevieWonderwastestedforthecurrentimplementationofthesystem.CalculatingthreeDTWdistances,findingtheaverageofthethree,andpaddingthisaveragewithatolerancegavetheabilitytoreliablymatchtheliveperformancetotheprimaryperformance.Throughthetestingandprojectdemonstrationphases,itisshownthattheimplementationisfullyfunctional.

6.3PossibleModifications(changedfromexpectationsandmodifications)

Theobstacleofdevelopingasoftwareplatformthatdigitizestheguitarsignal,analyzesasequenceofnotesplayedintimeandtriggersguitareffectsasintendedhasbeenovercome.Itisimportanttonote,however,thatthecurrentplatformisprogrammedtotriggeratthefirstinstanceofacalculatedmatch.

Duetotheprohibitivecostofeffectspedals,PureDataservesasacosteffectivealternativetopreprogramasequenceofeffectstoapre-recordedguitarsignalwithouttheuseofastompbox.Futureimplementationscouldinvolveaphysicalguitarpedaleffect,wheretheeffectsareintegratedseamlesslyintothesystem.Thisadditioncouldincludetheabilitytocontrolthevolumelevelofdifferentperformersinrelationbothtoeachotherandthecurrentsectionofasong.

Themostpromisingapproachtotheaforementionedpitfallsisatechniqueknownassubsequencedynamictimewarping.Forthepurposesofsignalcomparisonbetweenperformances,thesequencestobecomparedmayhaveasignificantdifferenceinlength.Insteadofaligningthesesequencesglobally,itisimperativetofindasubsequencewithinthelongersequencethatmatchestheshortersequence.Forexample,assumingthatthelongersequencerepresentsadatabasetobesearchedandtheshortersequenceanincomingperformance,ourobjectiveistoidentifythesubsequencewithinthedatabasethatismostsimilartotheincomingsignal.Influencedbytheworkof[21](Muller,M),analgorithmformatchdetectioncanbereverseengineeredfromthesubsequencelistgenerator.Itispresentedbelowinacombinationofmathematicalnotationandalgorithmicpseudocode.



LetX=(x1,x2,...,xN)andY=(y1,y2,...,yM)bemidisequencesfromthePureDataFiddleobject,whereM\>\>N(thismeansthatYisthedatabasesequence).Next,alocalcostfunctioncisassignedtoeachelementoftheDTWgrid.AtthispointthealgorithmmustfindasubsequenceY(a∗:b∗):=(ya∗,ya∗+1,...,yb∗)thatminimizestheDTWdistancetoourincomingsignaloverallpossiblesubsequencesoftherecordedfeaturesequence.

Algorithmicallyspeakingthatis:

(a\*,b\*):=argmin(DTW(X,Y(a:b))

Theindicesa∗andb∗inadditiontotheleastcostalignmentpossiblebetweentheincomingsignalandthesubsectionY(a∗:b∗)ofthestoredperformancecanbecomputedbyamodificationofthestandardDTWalgorithm.

Inordertoselectapathofleastresistancep∗,naturallyonewouldhavetocalculateeveryconceivablepaththroughthegrid.UnfortunatelythisrequirescomputationalcomplexitythatgrowsexponentiallyinboundsNandM.ThisprocesscanbeoptimizedtoanO(NM)complexitycomputation.Inabroadsense,theconceptistopenalizepathsbetweenthedatabaseandthequerythatmatchthequerytoindicesnearthebeginningorendofthedatabaseastoavoidaonetoonematchbetweensignals.

Algorithm:(AccumulatedcostmatrixandDTW-distance)

Instantiatesequences:X(1:n)=(x1,...xn)andY(1:m)=(y1,...ym)

Set

D(n,m)=DTW(X(1:n),Y(1:m))

D(n,m)isaNMmatrixDcalledthe*accumulatedcostmatrix*.Atuple(n,m)representingamatrixentryofthe*costmatrix*CorofDwillbereferredtoasacell.

Dsatisfiesthefollowing:

D(n,1)=Σ(fromk=1ton)c(xk,y0)"n∈[1:N]

D(1,m)=c(x0,ym)"m∈[1:M]

D(n,m)=argmin{D(n−1,m−1),D(n−1,m),D(n,m−1)}+c(xn,ym)"n∈[2:N]andm∈[2:N]

Onecanalsodefineanextendedaccumulatedcostmatrix:

Setting:

D(n,0)=∞"n∈[0:N]

D(0,m):=0"m∈[0:M].

Theindexb∗canbedeterminedfromD:

b∗=argmin{D(N,b)}

Todeterminethestartingindexofthesubsequencea∗andtheoptimalwarpingpathbetweenthestoredandincomingsignals.

Input:AccumulatedcostmatrixD.

Output:Optimalwarpingpathp∗.

Theoptimalpathp∗=(p1,...,pL)iscomputedinreverseorderoftheindicesstartingwithpL=(N,b∗).

Supposepl=(n,m)hasbeencomputed.Incase(n,m)=(1,1),onemusthavelto1andwearefinished.

Else:

pl−1=

"n=1:(1,m−1)

"m=1:(n−1,1)

else:argmin{D(n−1,m−1),D(n−1,m),D(n,m−1)}

a∗isthemaximalindexsuchthatpl=(a∗,1)

AllelementsofthestoredsequenceYleftofya∗andrightofyb∗areexcludedfromconsiderationanddonotincuradditionalcosts.

TheoptimalwarpingpathbetweenXandY(a∗:b∗)isgivenby(pl,...,pL)

![](Final%20Report%20SP2_files/image014.gif)

*Figure5:DatabaseSubsequenceMatchagainstIncomingSequence*



Dcanbeusedtogeneratealistofsubsequencesofincomingsignalthatmatchtherecordedtriggerpoint.

Createdistancefunction:

∆:[1:M]→R<sub>eal</sub>∆(b)=D(N,b)

∆assignstoeachindexbtheminimalDTWdistance∆(b)attainablebetweenthestoredsequenceandthesubsequenceoftheincomingsignalthatendsonindexb.

"b∈[1:M],theDTW-minimizinga∈[1:M]canbecomputedstartingwithpL=(N,b).

If∆(b)issmall\$b∈[1:M]andifa∈[1:M]denotesthecorrespondingDTW-minimizingindex,thenthesubsequenceY(a:b)matchestheincomingsection

Input:*incomingsignal*X=(x1,...,xN),*databasesequence*=(y1,...,yM),

costthreshold:τ

Output:Rankedlistofmatchesbetweenincomingsignalandsubsectionsofdatabasethathaveamatchtotheinputbelowthethresholdτ

Algorithm:(Matchlisttracker)

1.)Rankedlistmustinitiallybeempty

2.)CalculateD

3.)Calculatedistancefunction∆using∆(b)foreachsubsequenceofthedatabaseY

4.)Selectminimumb∗of∆.

5.)If∆(b∗)\>τthena*matchhasbeendetected*.

6.)Calculatecorrespondingmatch-subsequenceindexa∗∈[1:M]

7.)addsubsequenceY(a∗:b∗)torankedlist

8.)Set∆(b)=∞"bwithinasuitableneighborhoodofb∗

9.)Continuebycalculatingthenextminimizingindexuntilinputends.

Therule∆(b)=∞isintendedtoexcludeanaregionboundedbythenearestlocalmaximumstob∗fromcomputation.Thispreventsamatchlistthatcontainsmanysubsequencesthatdifferbyonlyaslightshift.

Thisapproachisafeasiblesolutionbecauseratherthanscanningthesongforatriggersequenceitwouldcreateadatabaseforeveryuserdefinedsectionofasong.Thiswouldallowthesystemtotrackthelivestatusoftheperformanceinrealtimeratherthanwaitingfortherightinputtogaugewhereintheperformancetheguitaristis.Becauseofthesectionallyspecificsubsequencelengthmatching,thisapproachwouldalsoyieldmoreaccuratematchesasthesectionofmusicbeinganalizedwouldnotbebasedonhardcodedwindowlengths.Mostimportantlythistechniqueisbuiltentirelyontheframeworkofthealgorithmweimplementedandthereforewouldonlyrequireexpansionofthecodeasopposedtoafulloutoverhaulofthesystem.

Potentialmodificationstothisplatformincludebutarenotlimitedtoanycontrolactionastheresultofthereadinginofanaudiosequence.Forexample,onecouldusetheaudiosignalofvirtuallyanyinstrumenttocontrolstagelighting,oradvanceamusicalscoreforasymphony.Itisalsopossibletodesignaphysicalhardwarekillswitchthattemporarilysuspendstheprogram,allowingthemusiciantoimproviseandthenjumpbackintothesongwithoutthrowingoffthesystem.Iftimepermits,thissystemcouldevenbeexpandedtoincludehardwareeffectpedalsthatareintegratedseamlesslyintothesystemortocontrolthevolumelevelofdifferentperformersinrelationbothtoeachotherandthecurrentsectionofasong.







































ListofReferences:

[1]Rouse,M.(2005,April).WhatisMIDI(MusicalInstrumentDigitalInterface)?-DefinitionfromWhatIs.com.RetrievedDecember10,2017,fromhttp://whatis.techtarget.com/definition/MIDI-Musical-Instrument-Digital-Interface

[2]FastFourierTransformTutorial.RetrievedDecember10,2017,fromhttp://w.astro.berkeley.edu/\~jrg/ngst/fft/fft.html

[3]Roos,D.(2008,March18).HowMIDIWorks.RetrievedDecember10,2017,from[http://entertainment.howstuffworks.com/midi1.htm](http://entertainment.howstuffworks.com/midi1.htm)

[4]BenjaminBengfort,ComputerandDataScientistFollow.(2014,July18).BeginnersGuidetoNon-NegativeMatrixFactorization.RetrievedDecember10,2017,from[https://www.slideshare.net/BenjaminBengfort/non-negative-matrix-factorization](https://www.slideshare.net/BenjaminBengfort/non-negative-matrix-factorization)

[5]A.StarkandM.Plumbley.Real-timechordrecognitionforliveperformance.InProceedingsofInternationalComputerMusicConference,volume8,pages585593.Citeseer,2009

[6]NasserKehtarnavaz.(2008May).DigitalSignalProcessingSystemDesign.LabVIEWBasedHybridProgramming.

[7]A.OzerovandC.Fevotte.Multichannelnonnegativematrixfactorizationinconvolutivemixturesforaudiosourceseparation.Audio,Speech,andLanguageProcessing,IEEETransactionson,18(3):550563,2010

[8]P.McLeodandG.Wyvill.Asmarterwaytofindpitch.InProceedingsofInternationalComputerMusicConference,ICMC,2005.

[9]P.McLeod.Fast,accuratepitchdetectiontoolsformusicanalysis.PhDthesis,PhDthesis,UniversityofOtago.DepartmentofComputerScience,2009.

[10]E.LarsonandR.Maddox.Real-timetime-domainpitchtrackingusingwavelets.ProceedingsoftheUniversityofIllinoisatUrbanaChampaignResearchExperienceforUndergraduatesProgram,2005.

[11]E.LarsonandR.Maddox.Real-timetime-domainpitchtrackingusingwavelets.ProceedingsoftheUniversityofIllinoisatUrbanaChampaignResearchExperienceforUndergraduatesProgram,2005.

[12]M.Brooks.Developingvisualizationsoftwareformusicians.2010.

[13]A.Dessein,A.Cont,andG.Lemaitre.Real-timepolyphonicmusictranscriptionwithnon-negativematrixfactorizationandbeta-divergence.InProc.11thInternationalSocietyforMusicInformationRetrievalConference(IS-MIR2010),page2,2010.

[14]C.Duxbury,M.Davies,andM.Sandler.Separationoftransientinformationinmusicalaudiousingmultiresolutionanalysistechniques.InProceedingsoftheCOSTG-6ConferenceonDigitalAudioEffects(DAFX-01),Limerick,Ireland,2001.

[15]AnInteractiveGuideToTheFourierTransform.(n.d.).RetrievedDecember10,2017

[16]TheScientistandEngineer'sGuidetoDigitalSignalProcessingByStevenW.Smith,Ph.D.(n.d.).RetrievedDecember10,2017

[17]KazukiYazawa,KatsutoshiItoyama,HiroshiG.Okuno,"Automatictranscriptionofguitartablaturefromaudiosignalsinaccordancewithplayer'sproficiency",AcousticsSpeechandSignalProcessing(ICASSP)2014IEEEInternationalConferenceon,pp.3122-3126,2014.

[18]IntroductiontoWaveletSignalProcessing(AdvancedSignalProcessingToolkit).(n.d.).RetrievedDecember10,2017

[19]Rioul,Olivier&Vetterli,Martin.(1991).Waveletsandsignalprocessing.SignalProcessingMagazine,IEEE.8.14-38.10.1109/79.91217.

[20]K.(n.d.).[helmholtz\~]findsthepitch.RetrievedDecember10,2017

[21]Muller,M.(1970,January01).DynamicTimeWarping(DTW).RetrievedDecember10,2017,fromhttps://link.springer.com/referenceworkentry/10.1007%2F978-0-387-73003-5\_768

[22]Cq2midiPolyphonicMIDInotesfromaudioforPureData.(n.d.).RetrievedDecember11,2017,fromhttps://grrrr.org/research/software/cq2midi/

[23]Chordetector\_pd.(n.d.).RetrievedDecember11,2017,fromhttps://patchstorage.com/chordetector\_pd/

[24]K.(n.d.).[Pd\~]graphicaldspprogramming.RetrievedDecember10,2017,fromhttp://www.katjaas.nl/puredata/puredata.html

[25]C.(n.d.).RetrievedDecember10,2017,from[http://www.phon.ox.ac.uk/jcoleman/old\_SLP/Lecture\_5/DTW\_explanation.html](http://www.phon.ox.ac.uk/jcoleman/old_SLP/Lecture_5/DTW_explanation.html)























Appendices:

**AppendixA:ProjectOverview**

**TeamMembers:**

![](Final%20Report%20SP2_files/image015.jpg)

RalphQuintoisaSeniorstudyingComputerEngineeringatTheCollegeofNewJersey.Heisthesoftwareengineerofthegroupandistaskedtoresearchforpossibleprogrammingplatforms.Inadditionheisresponsibleforreadingelectricguitarsignals,creatingthesignalanalysispatchesinpuredata,andtriggeringdigitalguitareffects.Postgraduation,Ralphplansonenteringtheindustryasasoftwareengineerandeventuallyobtaininghismaster'sinCybersecurity.Ralphshobbiesincludescompetinginbasketball,cooking,andplayingvideogames.



![](Final%20Report%20SP2_files/image016.gif)

HaleyScottisaseniorstudyingElectricalEngineeringatTheCollegeofNewJersey.Sheisthearchitecturalmanagerofthisdesignproject,handlingtaskssuchastheresearchofsystemmethods,thedesignandcreationofdigitaleffects,aswellasprojectandorganizationalmanagement.Shewillalsoensurethesuccessfulintegrationofallprojectcomponents.Upongraduation,Haleyplansonenteringthewaterandwastewaterindustry,andfurtheringhereducationaftergainingexperienceintheelectricaldesignsectorofthefield.Inherfreetime,Haleyenjoysplayingthepiano,spendingtimewithfamilyandfriends,andplayinggolf.



![](Final%20Report%20SP2_files/image017.jpg)

BryanGunerisaseniorstudyingElectricalEngineeringatTheCollegeofNewJersey.Heisteamleaderaswellasbeingtaskedwithdevelopingaprotocolfordigitalsignalprocessingoftheguitarsignalinordertocreateatime-sequentialrecordofthefrequencycontentoftheguitarsignal,andacomparisonbetweenprerecordedsongsandliveperformances.UpongraduationBryanintendstoworkinindustryhopefullyinadditiontopursuingamastersdegree.Hobbiesincludebutarenotlimitedto:guitar,music,hockey,physics,philosophy,art,andspendingtimewithgoodfriends.



**EngineeringStandards:**

**IEEESTD730-2014(RevisionofIEEESTD730-2002)-IEEEStandardforSoftwareQualityAssuranceProcesses**

●SoftwareutilizedwillmeetqualityrequirementsaccordingtotheIEEE730-2014StandardforSoftwareQualityAssuranceProcesses



**RealisticConstraints:**

<table>
<colwidth="50%"/>
<colwidth="50%"/>
<tbody>
<trclass="odd">
<tdalign="left"><p><strong>DesignRequirement</strong></p></td>
<tdalign="left"><p><strong>RealisticConstraints</strong></p></td>
</tr>
<trclass="even">
<tdalign="left"><p>Soundoutputmustbeloudenoughtohear,between0dBto65dB</p></td>
<tdalign="left"><p>Speakerswillnotproducesoundover85dBtoeliminatechancesofpermanenthearingdamage</p></td>
</tr>
<trclass="odd">
<tdalign="left"><p>Guitarmustbeconnectedtocomputerthroughoutrecordingphaseandliveperformancephase</p></td>
<tdalign="left"><p>Cordmustonlybedetachedinanidlephase,notduringrecordingorliveperformance</p></td>
</tr>
<trclass="even">
<tdalign="left"><p>Minimumnoteonsetseparation</p></td>
<tdalign="left"><p>Samplingrate44.1KHz</p></td>
</tr>
<trclass="odd">
<tdalign="left"><p>Triggerlatency</p></td>
<tdalign="left"><p>Processorspeed,O(NM)computation,lengthofsegment</p></td>
</tr>
</tbody>
</table>







**ModernEngineeringTools:**

●PureData

●Java

●C

●CodeBlocks

●Excel

**AppendixB:ProjectManagement**

**GanttChart:**

**![](Final%20Report%20SP2_files/image018.gif)**





****

****

**TimeBudget**

![](Final%20Report%20SP2_files/image019.gif)

**ListofContacts:**

●AmbroseAdegbege

○(609)771-2863

○Adegebega@tcnj.edu



**MaterialList:**

●ElectricGuitar

●toUSBadapter

●Computer

●PureData





**FinancialBudget**

●toUSBadapter(\$10)

●SeniorProjectPoster(\$82)

![](Final%20Report%20SP2_files/image020.gif)

****

**ProjectMeetingMinutes:**

Meeting1
Date:August30,2017
Time:30Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Possiblesolutionsforproject
Organizationalmanagementforsemester
Designideasandconcepts
Meeting2
Date:September6,2017
Time:60Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Initialdesignreviewideas
Designreview1
Projectsolutions(Logic,GarageBand,MIDI)
Meeting3
Date:September11,2017
Time:30Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Designreview
Scheduling
Possiblecandidateplatforms
Meeting4
Date:September27,2017
Time:30minutes
Present:Bryan,Haley,Ralph
Absent:Dr.Adegbege
DiscussionItems:
Actionitems
Reviewedindividualresearch
Meeting5
Date:October4,2017
Time:60Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Systemarchitecture
Adaptivethresholdconcept
Neuralnetworkimplementation
Lowpassfilterimplementation
Pythonimplementation
Meeting6
Date:October11,2017
Time:60Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Featureidentification
Rhythm(transient)
Pitch(steadystate)
Applyingourconceptstootherprojects(automaticscoring)
Meeting7
Date:October18,2017
Time:30Minutes
Present:Bryan,Ralph,Dr.Adegbege
Absent:Haley
DiscussionItems:
Fuzzylogic
DynamicTimewarping
Implementationideas
Meeting8
Date:November1,2017
Time:30Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Adaptivefiltering
DynamicTimewarping
Lowpassfiltering
PureData
Userinterface
Meeting9
Date:November8,2017
Time:30Minutes
Present:Bryan,Haley,Dr.Adegbege
Absent:Ralph
DiscussionItems:
LabVIEW
Guitartuner
Binarysearchalgorithminmatchingsequences
Website/Wordpress
Meeting10
Date:November15,2017
Time:60Minutes
Present:Bryan,Haley,Dr.Adegbege
Absent:Ralph
DiscussionItems:
Baselinefunctionality
Demonstrationsandtesting
Contentsoffinalreport
Importanceofabstract
Meeting11
Date:November29,2017
Time:30Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Realisticconstraints
Finaldesignreview
Finalreport
Videodemonstrationideas

Meeting12
Date:January31,2018
Time:60Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Semesterplansandschedules
ProgresswithexternalforPd
PDRpresentation
ModifyDTW

Meeting13
Date:February5,2018
Time:30Minutes
Present:Bryan,Haley,Ralph
Absent:None
DiscussionItems:
ReviewPDR
ConvertpseudocodeintoC
Designmorecomplexeffect
Researchexternals

Meeting14
Date:February7,2018
Time:30Minutes
Present:Haley,Ralph,Dr.Adegbege
Absent:Bryan
DiscussionItems:
Progressoneffect
WAVfileresearch
TCFpreparation
Demonstrationpreparation

Meeting15
Date:February14,2018
Time:60Minutes
Present:Haley,Bryan,Ralph,Dr.Adegbege
Absent:
DiscussionItems:
Reimbursementforcable
Roadblockswithinputformat
Progressoneffect
Realisticconstraintdiscussion

Meeting16
Date:February26,2018
Time:60Minutes
Present:Haley,Ralph
Absent:Bryan
DiscussionItems:
Codemanipulationcompleted
Discussionoftestingphase
Testprocedure
Reimbursementnotyetdelivered

Meeting17
Date:February28,2018
Time:120Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
ProgresswithbasicGUI
Testingandimplementation
Effectprogress
Externalprogress

Meeting18
Date:March3,2018
Time:60Minutes
Present:Bryan,Haley,Ralph
Absent:None
DiscussionItems:
PosterLayout
PosterContent
Draftreport
ModifyDTWcode

Meeting19
Date:March27,2018
Time:60Minutes
Present:Bryan,Haley,Ralph,Dr.Adegbege
Absent:None
DiscussionItems:
Testingofsoftware
Celebrationpreparation
Presentationpreparation
Reimbursementforposter

Meeting20
Date:April3,2018
Time:120Minutes
Present:Bryan,Haley,Ralph
Absent:None
DiscussionItems:
Softwaretesting
Latencytesting
Triggeringtestingandadjustments
Scheduleplanningandupdates

Meeting21
Date:April11,2018
Time:60Minutes
Present:Bryan,Haley,Ralph
Absent:None
DiscussionItems:
Softwaretesting
Softwareadjustments
Schedulingfortimeandbudget
Reimbursement(1)received

Meeting22
Date:April15,2018
Time:60Minutes
Present:Haley,Ralph
Absent:Bryan
DiscussionItems:
Guitartestingwithsimplesequence
Softwareadjustments
Plansfordraft,finalpresentation
PlannednextmeetingwithDr.Adegbege

Meeting23
Date:April17,2018
Time:60Minutes
Present:Bryan,Haley,Ralph
Absent:None
DiscussionItems:
Softwaretesting
Softwareadjustments
Testingdatarecorded
Testingwithdifferenttimewindows

Meeting24
Date:April24,2018
Time:60Minutes
Present:Haley,Ralph
Absent:Bryan
DiscussionItems:
Finalreport
Packagingofproject
Demonstrationfeasibility
Reimbursement

Meeting1
Date:April29,2018
Time:120Minutes
Present:Bryan,Haley,Ralph
Absent:None
DiscussionItems:
Finalizationofpresentation
Organizationalmanagementforsemester
Rehearsaloffinalpresentation

**SupportingFigures:Ralph**

![](Final%20Report%20SP2_files/image021.gif)

Figure1:FuzzEffectPd



![](Final%20Report%20SP2_files/image022.gif)

Figure2:DelayEffectPd



![](Final%20Report%20SP2_files/image023.gif)

Figure3:ReverbEffectPd

![](Final%20Report%20SP2_files/image024.gif)

Figure4:SpectralDelayEffectPd



![](Final%20Report%20SP2_files/image025.gif)

Figure5:PdModule



![](Final%20Report%20SP2_files/image026.jpg)

Figure6:SimplifiedPdBlockDiagram



![](Final%20Report%20SP2_files/image027.gif)

Figure7:DTWPdObject



**JavaCodeofDynamicTimeWarping:**

publicclassDTW{

privatedouble[]horizontalInput;

privatedouble[]verticalInput;

publicDTW(double[]horizontalInput,double[]verticalInput){

this.horizontalInput=horizontalInput;

this.verticalInput=verticalInput;

}

*/\**

*Findstheminimumcostpathtoreachcurrentvalue*

*\*/*

privatestaticdoublemin(MatrixTripletmatrixTriplet){

returnMath.min(Math.min(matrixTriplet.left,matrixTriplet.bottom),

matrixTriplet.bottomLeft);

}



*/\**

*Thisfindsthesquareddifferenceofthematrixpoints*

*Generatesa2Darrayandreturnsthesymmetricaldistancemeasure*

*\*/*

privatedouble[][]buildDistanceMatrix(){

introws=verticalInput.length;

intcols=horizontalInput.length;

double[][]matrix=newdouble[rows+1][cols+1];

for(inti=1;i\<matrix[0].length;++i){

matrix[0][i]=horizontalInput[i-1];

}

for(inti=1;i\<matrix.length;++i){

matrix[i][0]=verticalInput[i-1];

}

for(introw=1;row\<=rows;++row){

for(intcol=1;col\<=cols;++col){

matrix[row][col]=(int)Math.pow(matrix[0][col]-matrix[row][0],2);

}

}

returnmatrix;

}

*/\**

*Findstheleftandbottominitialcostvalues.Initializationphase*

*\*/*

privatestaticMatrixTriplet[][]buildTripleMatrixWithLeftAndBottomValues(double[][]distanceMatrix){

introws=distanceMatrix.length;

intcols=distanceMatrix[0].length;

MatrixTriplet[][]leftAndBottomMatrix=newMatrixTriplet[rows][cols];

for(introw=0;row\<rows;++row){

for(intcol=0;col\<cols;++col){

leftAndBottomMatrix[row][col]=newMatrixTriplet(distanceMatrix[row][col]);

}

}

leftAndBottomMatrix[1][1].left=distanceMatrix[1][1];

for(intcol=2;col\<cols;++col){

leftAndBottomMatrix[1][col].left=leftAndBottomMatrix[1][col-1].left

+distanceMatrix[1][col];

leftAndBottomMatrix[1][col].bottom=leftAndBottomMatrix[1][col].left;

}

leftAndBottomMatrix[1][1].bottom=distanceMatrix[1][1];

for(introw=2;row\<rows;++row){

leftAndBottomMatrix[row][1].bottom=leftAndBottomMatrix[row-1][1].bottom

+distanceMatrix[row][1];

leftAndBottomMatrix[row][1].left=leftAndBottomMatrix[row][1].bottom;

}

returnleftAndBottomMatrix;

}

*/\**

*Findstheleft/bottom/bottomleftcostvalues*

*\*/*

privatestaticMatrixTriplet[][]buildFinalMatrix(MatrixTriplet[][]leftAndBottomMatrix){

introws=leftAndBottomMatrix.length;

intcols=leftAndBottomMatrix.length;

MatrixTriplet[][]finalMatrix=newMatrixTriplet[rows][cols];

for(introw=0;row\<rows;++row){

for(intcol=0;col\<cols;++col){

finalMatrix[row][col]=new

MatrixTriplet(leftAndBottomMatrix[row][col].initial,

leftAndBottomMatrix[row][col].left,

leftAndBottomMatrix[row][col].bottom,

leftAndBottomMatrix[row][col].bottomLeft);

}

}

for(introw=2;row\<rows;++row){

for(intcol=2;col\<cols;++col){

finalMatrix[row][col].left=min(finalMatrix[row][col-1])

+finalMatrix[row][col].initial;

finalMatrix[row][col].bottom=min(finalMatrix[row-1][col])

+finalMatrix[row][col].initial;

finalMatrix[row][col].bottomLeft=min(finalMatrix[row-1][col-1])

+finalMatrix[row][col].initial;

}

}

returnfinalMatrix;

}

privatedoublecompute(){

double[][]distanceMatrix=buildDistanceMatrix();

MatrixTriplet[][]leftAndBottomValuesTripletMatrix=

buildTripleMatrixWithLeftAndBottomValues(distanceMatrix);

MatrixTriplet[][]finalMatrix=buildFinalMatrix(leftAndBottomValuesTripletMatrix);

returnmin(finalMatrix[verticalInput.length][horizontalInput.length]);

}

privatestaticclassMatrixTriplet{

doubleinitial=Double.POSITIVE\_INFINITY;

doubleleft=Double.POSITIVE\_INFINITY;

doublebottom=Double.POSITIVE\_INFINITY;

doublebottomLeft=Double.POSITIVE\_INFINITY;

MatrixTriplet(doubleinitial,doubleleft,doublebottom,doublebottomLeft){

this.initial=initial;

this.left=left;

this.bottom=bottom;

this.bottomLeft=bottomLeft;

}

MatrixTriplet(doubleinitial){

this.initial=initial;

}

}

publicstaticvoidmain(String[]args){

*//double[]horizontalInput1={1.0,1.0,2.0,3.0,2.0,0.0};*

*//double[]verticalInput1={0.0,1.0,1.0,2.0,3.0,2.0,1.0};*

*//DTWsimilarInputs=newDTW(horizontalInput1,verticalInput1);*

*//doubleresult=similarInputs.compute();*

double[]horizontalInput2={0.0,1.0,1.0,2.0,3.0,2.0,1.0};

double[]verticalInput2={0.0,1.0,1.0,2.0,3.0,2.0,1.0};

DTWsameInputs=newDTW(horizontalInput2,verticalInput2);

doubleresult2=sameInputs.compute();

System.out.println("LeastcostpathofTest1:"+result2);

double[]horizontalInput3={1.0,1.0,2.0,3.0,2.0,0.0};

double[]verticalInput3={0.0,0.0,1.0,2.0,1.0,-1.0};

DTWsameInputsOutPhase=newDTW(horizontalInput3,verticalInput3);

doubleresult3=sameInputsOutPhase.compute();

System.out.println("LeastcostpathofTest2:"+result3);

*//double[]horizontalInput4={1.0,2.0,3.0,4.0,2.0,1.0};*

*//double[]verticalInput4={5.0,0.0,1.0,4.0,2.0,0.0,3.0};*

*//DTWdifferentInputs=newDTW(horizontalInput4,verticalInput4);*

*//doubleresult4=differentInputs.compute();*

*//System.out.println("LeastcostpathofTest4:"+result4);*

}

}

**DynamicTimeWarpingPDObjectCcode:**

\#include"m\_pd.h"

\#include\<math.h\>

\#include\<stdio.h\>

\#include\<stdlib.h\>

\#include\<stdio.h\>

\#include\<time.h\>

\#include\<windows.h\>



\#defineSIZE\_ARRAY300

\#defineTEST\_SIZE300



statict\_class\*dynamicTW\_class;//handlefortheclass



floatrecording\_array[SIZE\_ARRAY]={0};

intarr\_position=SIZE\_ARRAY-1;

floatsaveValue=0.0;

inttriggerGlobal=0;

floatdelayTime=0.0;



/\*structtoholdcostofarrivalfromleft,bottom,anddiagonal\*/

typedefstruct\_leftbottom{

floatleft;

floatbottom;

floatdiag;

}leftBD;//typedefname



typedefstruct\_dynamicTW{

t\_objectx\_obj;



intflag;//differentiatesifhowresultoflcpisstored

intmatch;//if0signaldoesnotmatchelsematches

floattestArray[TEST\_SIZE];

floatstoredSignalOne[SIZE\_ARRAY];

floatstoredSignalTwo[SIZE\_ARRAY];



t\_inlet\*in\_mod\_A,\*in\_mod\_B;

t\_outlet\*out\_A;



floatsignal[SIZE\_ARRAY];

floatlcpValue;

floatcompareValue;



floatinitMatrix[SIZE\_ARRAY][SIZE\_ARRAY];

leftBDcostValues[SIZE\_ARRAY-1][SIZE\_ARRAY-1];



}t\_dynamicTW;//typedefname



voidcheckStorage(t\_dynamicTW\*x){//checkifvaluesbeingstoredcorrectly

inti;

post("incheckstorage");

for(i=0;i\<TEST\_SIZE;i++){

post("Signal1:%f",x-\>storedSignalOne[i]);

post("Signal2:%f",x-\>storedSignalTwo[i]);

}

}



voidsignalMatch(t\_dynamicTW\*x){

floattenup=saveValue+(.05\*saveValue);

floatzeroValue=0.00;

FILE\*fp1;

FILE\*fp2;

FILE\*fp3;

intj;

if(x-\>compareValue\<=tenup&&x-\>compareValue\>=zeroValue){

Sleep(delayTime\*1000);//howlongtodelaybanginseconds;

outlet\_bang(x-\>out\_A);

x-\>match=1;

/\*addcodetotriggereffect\*/

post("IncomingSignalMatchesStoredSignal.compareValueis%fandlcpValueis%f",x-\>compareValue,saveValue);

post("delaytime:%f",delayTime);

fp1=fopen("C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\save1.txt","w");

fp2=fopen("C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\save2.txt","w");

fp3=fopen("C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\save3.txt","w");

post("saving");

for(j=0;j\<SIZE\_ARRAY;j++){

fprintf(fp1,"%f\\n",x-\>storedSignalOne[j]);

fprintf(fp2,"%f\\n",x-\>storedSignalTwo[j]);

fprintf(fp3,"%f\\n",x-\>initMatrix[0][j]);

}

post("finishsaving");

fclose(fp1);

fclose(fp2);

fclose(fp3);

}

else{

x-\>match=0;

post("SignalNOMatch.compareValis%fwhilelcpValis%f\\n",x-\>compareValue,saveValue);

}

}

floatfindMin(t\_dynamicTW\*x,introw,intcolumn){

floattemp,min;

floatcheckLeft=x-\>costValues[row][column].left;

floatcheckBottom=x-\>costValues[row][column].bottom;

floatcheckDiagonal=x-\>costValues[row][column].diag;



temp=(checkLeft\<checkBottom)?checkLeft:checkBottom;

min=(checkDiagonal\<temp)?checkDiagonal:temp;

returnmin;

}

voidreverseArray(t\_dynamicTW\*x){

inti,j;

i=SIZE\_ARRAY-1;

j=0;

while(i\>j){

floattemp=x-\>storedSignalTwo[i];

x-\>storedSignalTwo[i]=x-\>storedSignalTwo[j];

x-\>storedSignalTwo[j]=temp;

i--;

j++;

}

}



voidfileReader1(t\_dynamicTW\*x,char\*path){

//charconst\*constfileName="C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\input.txt";/\*shouldcheckthatargc\>1\*/

FILE\*file=fopen(path,"r");/\*shouldchecktheresult\*/

charline[256];

inti=0;

while(fgets(line,sizeof(line),file)){

//post("file1:valueatline%dis%s",i,line);

x-\>storedSignalOne[i]=atof(line);//!!!!!!!!!!!!!!!!!!!!!REMOVE1000

i++;

}

fclose(file);

}

voidfileReader2(t\_dynamicTW\*x,char\*path){

//charconst\*constfileName="C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\input.txt";/\*shouldcheckthatargc\>1\*/

FILE\*file=fopen(path,"r");/\*shouldchecktheresult\*/

charline[256];

inti=0;

while(fgets(line,sizeof(line),file)){

//post("file2:valueatline%dis%s",i,line);

x-\>storedSignalTwo[i]=atof(line);//!!!!!!!!!!!!!!!!!!!!!!!!!!!REMOVE1000

i++;

}

fclose(file);

}



voidreplaceSignal2(t\_dynamicTW\*x){

inti;

for(i=0;i\<SIZE\_ARRAY;i++){

x-\>storedSignalTwo[i]=x-\>signal[i];

}

}



/\*

1.Createa2darrayforourmatrix

2.fillintheleftcolumnandbottomrowwithour2signals

3.Populatetherestofthematrix

4.calculateleastcostpath

\*/



voidleastCostPath(t\_dynamicTW\*x){

floattemp,min;

floatresult=0;

inti=SIZE\_ARRAY-2;

intj=SIZE\_ARRAY-2;



//post("startingpointvalueleftis%f",x-\>costValues[i][j].left);

//post("startingpointvaluebottomis%f",x-\>costValues[i][j].bottom);

//post("startingpointvaluediagis%f",x-\>costValues[i][j].diag);



while(i\>=0&&j\>=0){

floatcheckLeft=x-\>costValues[i][j].left;

floatcheckBottom=x-\>costValues[i][j].bottom;

floatcheckDiagonal=x-\>costValues[i][j].diag;



temp=(checkLeft\<checkBottom)?checkLeft:checkBottom;

min=(checkDiagonal\<temp)?checkDiagonal:temp;



result+=min;



/\*Changescelllocationafterfindingmin\*/

if(min==checkDiagonal){

if(i-1\<0&&j-1\<0){

break;

}

elseif(i-1\<0){

j--;

}

elseif(j-1\<0){

i--;

}

else{

i--;

j--;

}

}

elseif(min==checkLeft){

if(j-1\<0){

break;

}

else{

j--;

}

}

else{

if(i-1\<0){

break;

}

else{

i--;

}

}



}

if(x-\>flag==0){

saveValue+=result;

post("storingtosaveValue:currentsaveValueis%f",saveValue);

}

elseif(x-\>flag==1){

x-\>compareValue=result;

post("compareValue:leastcostpathis%f",x-\>compareValue);

}

}



voiddtw\_genMatrix(t\_dynamicTW\*x){

inti;

for(i=0;i\<SIZE\_ARRAY;i++){

x-\>initMatrix[i][0]=x-\>storedSignalOne[i];//populatethefirstcolumnwithsignal1datapoints

x-\>initMatrix[0][i]=x-\>storedSignalTwo[i];//populatethelastrowwithsignal2datapoints

}



/\*CalculatestheSymmetricaldistanceforeachmatrixcell\*/

intz,y;

for(z=1;z\<SIZE\_ARRAY;z++){

for(y=1;y\<SIZE\_ARRAY;y++){

floatdifference=x-\>storedSignalOne[z]-x-\>storedSignalTwo[y];

x-\>initMatrix[z][y]=(float)pow(difference,2);//findingthesymmetricaldistance

}

}



//initializingthecostValuesmatrix

intci,cj;

for(ci=0;ci\<SIZE\_ARRAY-1;ci++){

for(cj=0;cj\<SIZE\_ARRAY-1;cj++){

x-\>costValues[ci][cj].left=0;

x-\>costValues[ci][cj].bottom=0;

x-\>costValues[ci][cj].diag=0;

}

}

/\*Calculatesthecostofarrivalfromleft,bottom,anddiagonal\*/

intq,r;

for(q=0;q\<SIZE\_ARRAY-1;q++){

for(r=0;r\<SIZE\_ARRAY-1;r++){

//noleft,bottom,ordiagonalvalues//========README!!!!!==============changetoinitmatrix+1?

if(q==0&&r==0){

x-\>costValues[q][r].left=x-\>initMatrix[q+1][r+1];

x-\>costValues[q][r].bottom=x-\>initMatrix[q+1][r+1];

x-\>costValues[q][r].diag=x-\>initMatrix[q+1][r+1];

}

//ifrowisbottomtherecantbeanybottomvaluesordiagonalsosetleftvaluesonly

elseif(q==0){

if(r==0){//======READ|changetoinitmatrix+1again

x-\>costValues[q][r].left=x-\>initMatrix[q+1][r+1];//nopossibleleftvalues

}

else{

x-\>costValues[q][r].left=x-\>initMatrix[q+1][r+1]+findMin(x,q,(r-1));//=========changetocostofcurrentcellinitmatrix+minofcostvaluesofleftcell

}

x-\>costValues[q][r].bottom=1000\*1000;

x-\>costValues[q][r].diag=1000\*1000;

}



//ifcolumnislefttherecantbeanyleftvaluesordiagonalsosetbottomvaluesonly

elseif(r==0){

if(q==0){

x-\>costValues[q][r].bottom=x-\>initMatrix[q+1][r+1];//======READ|changetoinitmatrix+1again

}

else{

x-\>costValues[q][r].bottom=x-\>initMatrix[q+1][r+1]+findMin(x,(q-1),r);//=========changetocostofcurrentcellinitmatrix+minofcostvaluesofleftcell

}

x-\>costValues[q][r].left=1000\*1000;

x-\>costValues[q][r].diag=1000\*1000;

}



//musthaveleft,bottom,anddiagonalvalues

else{

x-\>costValues[q][r].left=x-\>initMatrix[q+1][r+1]+findMin(x,q,(r-1));//docurrentinitMatrixvalue+min

x-\>costValues[q][r].bottom=x-\>initMatrix[q+1][r+1]+findMin(x,(q-1),r);

x-\>costValues[q][r].diag=(.5\*x-\>initMatrix[q+1][r+1])+findMin(x,(q-1),(r-1));//diagonalmovementneedstobefavored



}



}

}



//intqq,rr;

//for(qq=0;qq\<SIZE\_ARRAY-1;qq++){

//for(rr=0;rr\<SIZE\_ARRAY-1;rr++){

//post("indexq:%dandr:%d",qq,rr);

//post("left:%f",x-\>costValues[qq][rr].left);

//post("bottom:%f",x-\>costValues[qq][rr].bottom);

//post("bottomLeft:%f\\n",x-\>costValues[qq][rr].diag);

//}

//}



leastCostPath(x);//findsleastcostpath

}



/\*Functionforwhenabangisreceived

\*-Calculatestheleastcostpathbetweeninput1andagaintstheother3signals

\*-Itisthenaveragedtogetherandchangestheflagvalue\*/

voiddtw\_onBangMsg(t\_dynamicTW\*x){

x-\>match=0;

x-\>flag=0;//makessothatlcpvaluegetsstoredinlcpValue

saveValue=0.0;

arr\_position=SIZE\_ARRAY-1;

fileReader1(x,"C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\input1.txt");//readsignal1

fileReader2(x,"C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\input2.txt");//readsignal2

dtw\_genMatrix(x);//performDTW

fileReader2(x,"C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\input3.txt");

dtw\_genMatrix(x);

fileReader2(x,"C:\\\\Users\\\\Raki\\\\Documents\\\\GitHub\\\\dynamicTW\\\\TB\\\\input4.txt");

dtw\_genMatrix(x);

saveValue=saveValue/3;

post("saveValue:LeastCostPathis%f",saveValue);

triggerGlobal=1;



}



voiddtw\_free(t\_dynamicTW\*x){

inlet\_free(x-\>in\_mod\_A);

inlet\_free(x-\>in\_mod\_B);

outlet\_free(x-\>out\_A);

}



voiddtw\_onSet\_A(t\_dynamicTW\*x,t\_floatargf){/\*functionthatgetscalledwhenaninputisreceived\*/

clock\_tt;

if(triggerGlobal==0){

/\*donothing\*/

}

//Sleep(2);

post("NumberA:%fsendingtoarray.Arr\_positionis%d",f,arr\_position);

post("DelayTime:%f",delayTime);



if(x-\>match==1){

post("Matchhasbeendetected.FreezingProgram!");

}

elseif(x-\>match==0){

if(arr\_position\>=0){//checksifarrayisfilled.Ifnotthenstoreincomingvaluetonextindex

x-\>signal[arr\_position]=f;

arr\_position--;

}



else{//Ifarrayisfilledshiftallvaluesby1indexandstoreatbeginningofarray

t=clock();



inti;

x-\>flag=1;//makesitsothatLCPresultisstoredincomparedValue;

for(i=SIZE\_ARRAY-1;i\>0;i--){

x-\>signal[i]=x-\>signal[i-1];

}

x-\>signal[0]=f;

replaceSignal2(x);//replacesthevalueinsignal2

reverseArray(x);

dtw\_genMatrix(x);//performsdtw



t=clock()-t;

doubletime\_taken=((double)t)/CLOCKS\_PER\_SEC;//inseconds

post("DTWtook%fsecondstoexecute",time\_taken);

signalMatch(x);//checksisthesignaliscorrectifitistriggereffect



//if(time\_taken==.002){

//Sleep(8);

//}

//elseif(time\_taken==.001){

//Sleep(9);

//}

}

}

}



voiddtw\_onSet\_B(t\_dynamicTW\*x,t\_floatargf){

delayTime=f;

}

//initializerfortheclass

void\*dynamicTW\_new(t\_floatargf1,t\_floatargf2){//parenthcontainscreationarg.tempstuffwillreplacedwitharrays

t\_dynamicTW\*x=(t\_dynamicTW\*)pd\_new(dynamicTW\_class);//initializestructoftypedtw

x-\>in\_mod\_A=inlet\_new(&x-\>x\_obj,&x-\>x\_obj.ob\_pd,&s\_float,gensym("ratio\_A"));

x-\>in\_mod\_B=inlet\_new(&x-\>x\_obj,&x-\>x\_obj.ob\_pd,&s\_float,gensym("ratio\_B"));

x-\>out\_A=outlet\_new(&x-\>x\_obj,&s\_bang);

return(void\*)x;

}





//functiontosetuptheclassandcallinitializer

voiddynamicTW\_setup(void){

/\*class\_new(t\_symbol\*name,t\_newmethodnewmethod,

t\_methodfreemethod,size\_tsize,intflags,t\_atomtypearg1,...);\*/

dynamicTW\_class=class\_new(gensym("dynamicTW"),//definesthesymbolinpuredata

(t\_newmethod)dynamicTW\_new,//inializingmethod

(t\_method)dtw\_free,

sizeof(t\_dynamicTW),

CLASS\_DEFAULT,//makesthebox

A\_DEFFLOAT,

A\_DEFFLOAT,

0);

class\_addbang(dynamicTW\_class,(t\_method)dtw\_onBangMsg);

class\_addmethod(dynamicTW\_class,

(t\_method)dtw\_onSet\_A,

gensym("ratio\_A"),

A\_DEFFLOAT,

0);

class\_addmethod(dynamicTW\_class,

(t\_method)dtw\_onSet\_B,

gensym("ratio\_B"),

A\_DEFFLOAT,

0);

}

**PureDataHeaderFile:**



/\*Copyright(c)1997-1999MillerPuckette.
\*Forinformationonusageandredistribution,andforaDISCLAIMEROFALL
\*WARRANTIES,seethefile,"LICENSE.txt,"inthisdistribution.\*/
\#ifndef\_\_m\_pd\_h\_
\#ifdefined(\_LANGUAGE\_C\_PLUS\_PLUS)||defined(\_\_cplusplus)
extern"C"{
\#endif
\#definePD\_MAJOR\_VERSION0
\#definePD\_MINOR\_VERSION48
\#definePD\_BUGFIX\_VERSION1
\#definePD\_TEST\_VERSION""
externintpd\_compatibilitylevel;/\*e.g.,43forpd0.43compatibility\*/
/\*oldnamefor"MSW"flag--wehavetotakeitforthesakeofmanyold
"nmakefiles"forexterns,whichwilldefineNTandnotMSW\*/
\#ifdefined(NT)&&!defined(MSW)
\#defineMSW
\#endif
/\*ThesepragmasareonlyusedforMSVC,notMinGWorCygwin\<hans@at.or.at\>\*/
\#ifdef\_MSC\_VER
/\*\#pragmawarning(disable:4091)\*/
\#pragmawarning(disable:4305)/\*uncastconstdoubletofloat\*/
\#pragmawarning(disable:4244)/\*uncastfloat/intconversionetc.\*/
\#pragmawarning(disable:4101)/\*unusedautomaticvariables\*/
\#endif/\*\_MSC\_VER\*/
/\*theexternalstorageclassis"extern"inUNIX;inMSWit'sugly.\*/
\#ifdef\_WIN32
\#ifdefPD\_INTERNAL
\#defineEXTERN\_\_declspec(dllexport)extern
\#else
\#defineEXTERN\_\_declspec(dllimport)extern
\#endif/\*PD\_INTERNAL\*/
\#else
\#defineEXTERNextern
\#endif/\*\_WIN32\*/
/\*Onmostccompilers,youcanjustsay"structfoo;"todeclarea
structurewhoseelementsaredefinedelsewhere.OnMSVC,whencompiling
C(butnotC++)code,youhavetosay"externstructfoo;".Sowemake
astupidmacro:\*/
\#ifdefined(\_MSC\_VER)&&!defined(\_LANGUAGE\_C\_PLUS\_PLUS)\\
&&!defined(\_\_cplusplus)
\#defineEXTERN\_STRUCTexternstruct
\#else
\#defineEXTERN\_STRUCTstruct
\#endif
/\*Definesomeattributes,specifictothecompiler\*/
\#ifdefined(\_\_GNUC\_\_)
\#defineATTRIBUTE\_FORMAT\_PRINTF(a,b)\_\_attribute\_\_((format(printf,a,b)))
\#else
\#defineATTRIBUTE\_FORMAT\_PRINTF(a,b)
\#endif
\#if!defined(\_SIZE\_T)&&!defined(\_SIZE\_T\_)
\#include\<stddef.h\>/\*justforsize\_t--howlame!\*/
\#endif
/\*MicrosoftVisualStudioisnotC99,itdoesnotprovidestdint.h\*/
\#ifdef\_MSC\_VER
typedefsigned\_\_int8int8\_t;
typedefsigned\_\_int16int16\_t;
typedefsigned\_\_int32int32\_t;
typedefsigned\_\_int64int64\_t;
typedefunsigned\_\_int8uint8\_t;
typedefunsigned\_\_int16uint16\_t;
typedefunsigned\_\_int32uint32\_t;
typedefunsigned\_\_int64uint64\_t;
\#else
\#include\<stdint.h\>
\#endif
/\*forFILE,neededbysys\_fopen()andsys\_fclose()only\*/
\#include\<stdio.h\>
\#defineMAXPDSTRING1000/\*usethisforanythingyouwant\*/
\#defineMAXPDARG5/\*maxnumberofargswecantypechecktoday\*/
/\*signedandunsignedintegertypesthesizeofapointer:\*/
\#if!defined(PD\_LONGINTTYPE)
\#definePD\_LONGINTTYPElong
\#endif
\#if!defined(PD\_FLOATSIZE)
/\*normally,ourfloats(t\_float,t\_sample,...)are32bit\*/
\#definePD\_FLOATSIZE32
\#endif
\#ifPD\_FLOATSIZE==32
\#definePD\_FLOATTYPEfloat
/\*anunsignedintofthesamesizeasFLOATTYPE:\*/
\#definePD\_FLOATUINTTYPEunsignedint
\#elifPD\_FLOATSIZE==64
\#definePD\_FLOATTYPEdouble
\#definePD\_FLOATUINTTYPEunsignedlong
\#else
\#errorinvalidFLOATSIZE:mustbe32or64
\#endif
typedefPD\_LONGINTTYPEt\_int;/\*pointer-sizeinteger\*/
typedefPD\_FLOATTYPEt\_float;/\*afloattypeatmostthesamesize\*/
typedefPD\_FLOATTYPEt\_floatarg;/\*floattypeforfunctioncalls\*/
typedefstruct\_symbol
{
char\*s\_name;
struct\_class\*\*s\_thing;
struct\_symbol\*s\_next;
}t\_symbol;
EXTERN\_STRUCT\_array;
\#definet\_arraystruct\_array/\*g\_canvas.h\*/
/\*pointerstoglistandarrayelementsgothrougha"stub"whichsticks
aroundaftertheglistorarrayisfreed.Thestubitselfisdeletedwhen
boththeglist/arrayisgoneandtherefcountiszero,ensuringthatno
gpointersarepointinghere.\*/
\#defineGP\_NONE0/\*thestubpointsnowhere(hasbeencutoff)\*/
\#defineGP\_GLIST1/\*thestubpointstoaglistelement\*/
\#defineGP\_ARRAY2/\*...orarray\*/
typedefstruct\_gstub
{
union
{
struct\_glist\*gs\_glist;/\*glistwe'rein\*/
struct\_array\*gs\_array;/\*arraywe'rein\*/
}gs\_un;
intgs\_which;/\*GP\_GLIST/GP\_ARRAY\*/
intgs\_refcount;/\*numberofgpointerspointinghere\*/
}t\_gstub;
typedefstruct\_gpointer/\*pointertoagobjinaglist\*/
{
union
{
struct\_scalar\*gp\_scalar;/\*scalarwe'rein(ifglist)\*/
unionword\*gp\_w;/\*rawdata(ifarray)\*/
}gp\_un;
intgp\_valid;/\*numberwhichmustmatchgpointee\*/
t\_gstub\*gp\_stub;/\*stubwhichpointstoglist/array\*/
}t\_gpointer;
typedefunionword
{
t\_floatw\_float;
t\_symbol\*w\_symbol;
t\_gpointer\*w\_gpointer;
t\_array\*w\_array;
struct\_binbuf\*w\_binbuf;
intw\_index;
}t\_word;
typedefenum
{
A\_NULL,
A\_FLOAT,
A\_SYMBOL,
A\_POINTER,
A\_SEMI,
A\_COMMA,
A\_DEFFLOAT,
A\_DEFSYM,
A\_DOLLAR,
A\_DOLLSYM,
A\_GIMME,
A\_CANT
}t\_atomtype;
\#defineA\_DEFSYMBOLA\_DEFSYM/\*betternameforthis\*/
typedefstruct\_atom
{
t\_atomtypea\_type;
unionworda\_w;
}t\_atom;
EXTERN\_STRUCT\_class;
\#definet\_classstruct\_class
EXTERN\_STRUCT\_outlet;
\#definet\_outletstruct\_outlet
EXTERN\_STRUCT\_inlet;
\#definet\_inletstruct\_inlet
EXTERN\_STRUCT\_binbuf;
\#definet\_binbufstruct\_binbuf
EXTERN\_STRUCT\_clock;
\#definet\_clockstruct\_clock
EXTERN\_STRUCT\_outconnect;
\#definet\_outconnectstruct\_outconnect
EXTERN\_STRUCT\_glist;
\#definet\_gliststruct\_glist
\#definet\_canvasstruct\_glist/\*LATERlosethis\*/
typedeft\_class\*t\_pd;/\*puredatum:nothingbutaclasspointer\*/
typedefstruct\_gobj/\*agraphicalobject\*/
{
t\_pdg\_pd;/\*puredatumheader(class)\*/
struct\_gobj\*g\_next;/\*nextinlist\*/
}t\_gobj;
typedefstruct\_scalar/\*agraphicalobjectholdingdata\*/
{
t\_gobjsc\_gobj;/\*headerforgraphicalobject\*/
t\_symbol\*sc\_template;/\*templatename(LATERreplacewithpointer)\*/
t\_wordsc\_vec[1];/\*indeterminate-lengtharrayofwords\*/
}t\_scalar;
typedefstruct\_text/\*patchableobject-graphical,withtext\*/
{
t\_gobjte\_g;/\*headerforgraphicalobject\*/
t\_binbuf\*te\_binbuf;/\*holderforthetext\*/
t\_outlet\*te\_outlet;/\*linkedlistofoutlets\*/
t\_inlet\*te\_inlet;/\*linkedlistofinlets\*/
shortte\_xpix;/\*x&ylocation(withinthetoplevel)\*/
shortte\_ypix;
shortte\_width;/\*requestedwidthinchars,0ifauto\*/
unsignedintte\_type:2;/\*fromdefsbelow\*/
}t\_text;
\#defineT\_TEXT0/\*justatextualcomment\*/
\#defineT\_OBJECT1/\*aMAXstylepatchableobject\*/
\#defineT\_MESSAGE2/\*aMAXtypemessage\*/
\#defineT\_ATOM3/\*acelltodisplayanumberorsymbol\*/
\#definete\_pdte\_g.g\_pd
/\*t\_objectissynonymfort\_text(LATERunifythem)\*/
typedefstruct\_textt\_object;
\#defineob\_outlette\_outlet
\#defineob\_inlette\_inlet
\#defineob\_binbufte\_binbuf
\#defineob\_pdte\_g.g\_pd
\#defineob\_gte\_g
typedefvoid(\*t\_method)(void);
typedefvoid\*(\*t\_newmethod)(void);
/\*inARM64avarargsprototypegeneratesadifferentfunctioncallsequence
fromafixedone,sointhatspecialcasewemakeamorerestrictive
definitionfort\_gotfn.Thiswillbreaksomecodeinthe"chaos"package
inPdextended.(thatcodewillrunincorrectlyanyhowsowhynotcatchit
atcompiletimeanyhow.)\*/
\#ifdefined(\_\_APPLE\_\_)&&defined(\_\_aarch64\_\_)
typedefvoid(\*t\_gotfn)(void\*x);
\#else
typedefvoid(\*t\_gotfn)(void\*x,...);
\#endif
/\*----------------pre-definedobjectsandsymbols--------------\*/
EXTERNt\_pdpd\_objectmaker;/\*factoryforcreating"object"boxes\*/
EXTERNt\_pdpd\_canvasmaker;/\*factoryforcreatingcanvases\*/
/\*---------prototypesfromthecentralmessagesystem-----------\*/
EXTERNvoidpd\_typedmess(t\_pd\*x,t\_symbol\*s,intargc,t\_atom\*argv);
EXTERNvoidpd\_forwardmess(t\_pd\*x,intargc,t\_atom\*argv);
EXTERNt\_symbol\*gensym(constchar\*s);
EXTERNt\_gotfngetfn(t\_pd\*x,t\_symbol\*s);
EXTERNt\_gotfnzgetfn(t\_pd\*x,t\_symbol\*s);
EXTERNvoidnullfn(void);
EXTERNvoidpd\_vmess(t\_pd\*x,t\_symbol\*s,char\*fmt,...);
/\*thefollowingmacrosareforsendingnon-type-checkablemessages,i.e.,
usingfunctionlookupbutcircumventingtypecheckingonarguments.Only
useforinternalmessagingprotectedbyA\_CANTsothatthemessagecan't
begeneratedatpatchlevel.\*/
\#definemess0(x,s)((\*getfn((x),(s)))((x)))
typedefvoid(\*t\_gotfn1)(void\*x,void\*arg1);
\#definemess1(x,s,a)((\*(t\_gotfn1)getfn((x),(s)))((x),(a)))
typedefvoid(\*t\_gotfn2)(void\*x,void\*arg1,void\*arg2);
\#definemess2(x,s,a,b)((\*(t\_gotfn2)getfn((x),(s)))((x),(a),(b)))
typedefvoid(\*t\_gotfn3)(void\*x,void\*arg1,void\*arg2,void\*arg3);
\#definemess3(x,s,a,b,c)((\*(t\_gotfn3)getfn((x),(s)))((x),(a),(b),(c)))
typedefvoid(\*t\_gotfn4)(void\*x,
void\*arg1,void\*arg2,void\*arg3,void\*arg4);
\#definemess4(x,s,a,b,c,d)\\
((\*(t\_gotfn4)getfn((x),(s)))((x),(a),(b),(c),(d)))
typedefvoid(\*t\_gotfn5)(void\*x,
void\*arg1,void\*arg2,void\*arg3,void\*arg4,void\*arg5);
\#definemess5(x,s,a,b,c,d,e)\\
((\*(t\_gotfn5)getfn((x),(s)))((x),(a),(b),(c),(d),(e)))
EXTERNvoidobj\_list(t\_object\*x,t\_symbol\*s,intargc,t\_atom\*argv);
EXTERNt\_pd\*pd\_newest(void);
/\*---------------memorymanagement--------------------\*/
EXTERNvoid\*getbytes(size\_tnbytes);
EXTERNvoid\*getzbytes(size\_tnbytes);
EXTERNvoid\*copybytes(void\*src,size\_tnbytes);
EXTERNvoidfreebytes(void\*x,size\_tnbytes);
EXTERNvoid\*resizebytes(void\*x,size\_toldsize,size\_tnewsize);
/\*--------------------atoms-----------------------------\*/
\#defineSETSEMI(atom)((atom)-\>a\_type=A\_SEMI,(atom)-\>a\_w.w\_index=0)
\#defineSETCOMMA(atom)((atom)-\>a\_type=A\_COMMA,(atom)-\>a\_w.w\_index=0)
\#defineSETPOINTER(atom,gp)((atom)-\>a\_type=A\_POINTER,\\
(atom)-\>a\_w.w\_gpointer=(gp))
\#defineSETFLOAT(atom,f)((atom)-\>a\_type=A\_FLOAT,(atom)-\>a\_w.w\_float=(f))
\#defineSETSYMBOL(atom,s)((atom)-\>a\_type=A\_SYMBOL,\\
(atom)-\>a\_w.w\_symbol=(s))
\#defineSETDOLLAR(atom,n)((atom)-\>a\_type=A\_DOLLAR,\\
(atom)-\>a\_w.w\_index=(n))
\#defineSETDOLLSYM(atom,s)((atom)-\>a\_type=A\_DOLLSYM,\\
(atom)-\>a\_w.w\_symbol=(s))
EXTERNt\_floatatom\_getfloat(t\_atom\*a);
EXTERNt\_intatom\_getint(t\_atom\*a);
EXTERNt\_symbol\*atom\_getsymbol(t\_atom\*a);
EXTERNt\_symbol\*atom\_gensym(t\_atom\*a);
EXTERNt\_floatatom\_getfloatarg(intwhich,intargc,t\_atom\*argv);
EXTERNt\_intatom\_getintarg(intwhich,intargc,t\_atom\*argv);
EXTERNt\_symbol\*atom\_getsymbolarg(intwhich,intargc,t\_atom\*argv);
EXTERNvoidatom\_string(t\_atom\*a,char\*buf,unsignedintbufsize);
/\*------------------binbufs---------------\*/
EXTERNt\_binbuf\*binbuf\_new(void);
EXTERNvoidbinbuf\_free(t\_binbuf\*x);
EXTERNt\_binbuf\*binbuf\_duplicate(t\_binbuf\*y);
EXTERNvoidbinbuf\_text(t\_binbuf\*x,constchar\*text,size\_tsize);
EXTERNvoidbinbuf\_gettext(t\_binbuf\*x,char\*\*bufp,int\*lengthp);
EXTERNvoidbinbuf\_clear(t\_binbuf\*x);
EXTERNvoidbinbuf\_add(t\_binbuf\*x,intargc,t\_atom\*argv);
EXTERNvoidbinbuf\_addv(t\_binbuf\*x,char\*fmt,...);
EXTERNvoidbinbuf\_addbinbuf(t\_binbuf\*x,t\_binbuf\*y);
EXTERNvoidbinbuf\_addsemi(t\_binbuf\*x);
EXTERNvoidbinbuf\_restore(t\_binbuf\*x,intargc,t\_atom\*argv);
EXTERNvoidbinbuf\_print(t\_binbuf\*x);
EXTERNintbinbuf\_getnatom(t\_binbuf\*x);
EXTERNt\_atom\*binbuf\_getvec(t\_binbuf\*x);
EXTERNintbinbuf\_resize(t\_binbuf\*x,intnewsize);
EXTERNvoidbinbuf\_eval(t\_binbuf\*x,t\_pd\*target,intargc,t\_atom\*argv);
EXTERNintbinbuf\_read(t\_binbuf\*b,char\*filename,char\*dirname,
intcrflag);
EXTERNintbinbuf\_read\_via\_canvas(t\_binbuf\*b,char\*filename,t\_canvas\*canvas,
intcrflag);
EXTERNintbinbuf\_read\_via\_path(t\_binbuf\*b,char\*filename,char\*dirname,
intcrflag);
EXTERNintbinbuf\_write(t\_binbuf\*x,char\*filename,char\*dir,
intcrflag);
EXTERNvoidbinbuf\_evalfile(t\_symbol\*name,t\_symbol\*dir);
EXTERNt\_symbol\*binbuf\_realizedollsym(t\_symbol\*s,intac,t\_atom\*av,
inttonew);
/\*------------------clocks---------------\*/
EXTERNt\_clock\*clock\_new(void\*owner,t\_methodfn);
EXTERNvoidclock\_set(t\_clock\*x,doublesystime);
EXTERNvoidclock\_delay(t\_clock\*x,doubledelaytime);
EXTERNvoidclock\_unset(t\_clock\*x);
EXTERNvoidclock\_setunit(t\_clock\*x,doubletimeunit,intsampflag);
EXTERNdoubleclock\_getlogicaltime(void);
EXTERNdoubleclock\_getsystime(void);/\*OBSOLETE;useclock\_getlogicaltime()\*/
EXTERNdoubleclock\_gettimesince(doubleprevsystime);
EXTERNdoubleclock\_gettimesincewithunits(doubleprevsystime,
doubleunits,intsampflag);
EXTERNdoubleclock\_getsystimeafter(doubledelaytime);
EXTERNvoidclock\_free(t\_clock\*x);
/\*-----------------puredata----------------\*/
EXTERNt\_pd\*pd\_new(t\_class\*cls);
EXTERNvoidpd\_free(t\_pd\*x);
EXTERNvoidpd\_bind(t\_pd\*x,t\_symbol\*s);
EXTERNvoidpd\_unbind(t\_pd\*x,t\_symbol\*s);
EXTERNt\_pd\*pd\_findbyclass(t\_symbol\*s,t\_class\*c);
EXTERNvoidpd\_pushsym(t\_pd\*x);
EXTERNvoidpd\_popsym(t\_pd\*x);
EXTERNt\_symbol\*pd\_getfilename(void);
EXTERNt\_symbol\*pd\_getdirname(void);
EXTERNvoidpd\_bang(t\_pd\*x);
EXTERNvoidpd\_pointer(t\_pd\*x,t\_gpointer\*gp);
EXTERNvoidpd\_float(t\_pd\*x,t\_floatf);
EXTERNvoidpd\_symbol(t\_pd\*x,t\_symbol\*s);
EXTERNvoidpd\_list(t\_pd\*x,t\_symbol\*s,intargc,t\_atom\*argv);
EXTERNvoidpd\_anything(t\_pd\*x,t\_symbol\*s,intargc,t\_atom\*argv);
\#definepd\_class(x)(\*(x))
/\*-----------------pointers----------------\*/
EXTERNvoidgpointer\_init(t\_gpointer\*gp);
EXTERNvoidgpointer\_copy(constt\_gpointer\*gpfrom,t\_gpointer\*gpto);
EXTERNvoidgpointer\_unset(t\_gpointer\*gp);
EXTERNintgpointer\_check(constt\_gpointer\*gp,intheadok);
/\*-----------------patchable"objects"--------------\*/
EXTERNt\_inlet\*inlet\_new(t\_object\*owner,t\_pd\*dest,t\_symbol\*s1,
t\_symbol\*s2);
EXTERNt\_inlet\*pointerinlet\_new(t\_object\*owner,t\_gpointer\*gp);
EXTERNt\_inlet\*floatinlet\_new(t\_object\*owner,t\_float\*fp);
EXTERNt\_inlet\*symbolinlet\_new(t\_object\*owner,t\_symbol\*\*sp);
EXTERNt\_inlet\*signalinlet\_new(t\_object\*owner,t\_floatf);
EXTERNvoidinlet\_free(t\_inlet\*x);
EXTERNt\_outlet\*outlet\_new(t\_object\*owner,t\_symbol\*s);
EXTERNvoidoutlet\_bang(t\_outlet\*x);
EXTERNvoidoutlet\_pointer(t\_outlet\*x,t\_gpointer\*gp);
EXTERNvoidoutlet\_float(t\_outlet\*x,t\_floatf);
EXTERNvoidoutlet\_symbol(t\_outlet\*x,t\_symbol\*s);
EXTERNvoidoutlet\_list(t\_outlet\*x,t\_symbol\*s,intargc,t\_atom\*argv);
EXTERNvoidoutlet\_anything(t\_outlet\*x,t\_symbol\*s,intargc,t\_atom\*argv);
EXTERNt\_symbol\*outlet\_getsymbol(t\_outlet\*x);
EXTERNvoidoutlet\_free(t\_outlet\*x);
EXTERNt\_object\*pd\_checkobject(t\_pd\*x);
/\*--------------------canvases--------------\*/
EXTERNvoidglob\_setfilename(void\*dummy,t\_symbol\*name,t\_symbol\*dir);
EXTERNvoidcanvas\_setargs(intargc,t\_atom\*argv);
EXTERNvoidcanvas\_getargs(int\*argcp,t\_atom\*\*argvp);
EXTERNt\_symbol\*canvas\_getcurrentdir(void);
EXTERNt\_glist\*canvas\_getcurrent(void);
EXTERNvoidcanvas\_makefilename(t\_glist\*c,char\*file,
char\*result,intresultsize);
EXTERNt\_symbol\*canvas\_getdir(t\_glist\*x);
EXTERNcharsys\_font[];/\*defaulttypefacesetins\_main.c\*/
EXTERNcharsys\_fontweight[];/\*defaultfontweightsetins\_main.c\*/
EXTERNintsys\_hostfontsize(intfontsize,intzoom);
EXTERNintsys\_zoomfontwidth(intfontsize,intzoom,intworstcase);
EXTERNintsys\_zoomfontheight(intfontsize,intzoom,intworstcase);
EXTERNintsys\_fontwidth(intfontsize);
EXTERNintsys\_fontheight(intfontsize);
EXTERNvoidcanvas\_dataproperties(t\_glist\*x,t\_scalar\*sc,t\_binbuf\*b);
EXTERNintcanvas\_open(t\_canvas\*x,constchar\*name,constchar\*ext,
char\*dirresult,char\*\*nameresult,unsignedintsize,intbin);
/\*----------------widgetbehaviors----------------------\*/
EXTERN\_STRUCT\_widgetbehavior;
\#definet\_widgetbehaviorstruct\_widgetbehavior
EXTERN\_STRUCT\_parentwidgetbehavior;
\#definet\_parentwidgetbehaviorstruct\_parentwidgetbehavior
EXTERNconstt\_parentwidgetbehavior\*pd\_getparentwidget(t\_pd\*x);
/\*--------------------classes--------------\*/
\#defineCLASS\_DEFAULT0/\*flagsfornewclassesbelow\*/
\#defineCLASS\_PD1
\#defineCLASS\_GOBJ2
\#defineCLASS\_PATCHABLE3
\#defineCLASS\_NOINLET8
\#defineCLASS\_TYPEMASK3
EXTERNt\_class\*class\_new(t\_symbol\*name,t\_newmethodnewmethod,
t\_methodfreemethod,size\_tsize,intflags,t\_atomtypearg1,...);
EXTERNvoidclass\_addcreator(t\_newmethodnewmethod,t\_symbol\*s,
t\_atomtypetype1,...);
EXTERNvoidclass\_addmethod(t\_class\*c,t\_methodfn,t\_symbol\*sel,
t\_atomtypearg1,...);
EXTERNvoidclass\_addbang(t\_class\*c,t\_methodfn);
EXTERNvoidclass\_addpointer(t\_class\*c,t\_methodfn);
EXTERNvoidclass\_doaddfloat(t\_class\*c,t\_methodfn);
EXTERNvoidclass\_addsymbol(t\_class\*c,t\_methodfn);
EXTERNvoidclass\_addlist(t\_class\*c,t\_methodfn);
EXTERNvoidclass\_addanything(t\_class\*c,t\_methodfn);
EXTERNvoidclass\_sethelpsymbol(t\_class\*c,t\_symbol\*s);
EXTERNvoidclass\_setwidget(t\_class\*c,constt\_widgetbehavior\*w);
EXTERNvoidclass\_setparentwidget(t\_class\*c,constt\_parentwidgetbehavior\*w);
EXTERNconstt\_parentwidgetbehavior\*class\_parentwidget(t\_class\*c);
EXTERNchar\*class\_getname(t\_class\*c);
EXTERNchar\*class\_gethelpname(t\_class\*c);
EXTERNchar\*class\_gethelpdir(t\_class\*c);
EXTERNvoidclass\_setdrawcommand(t\_class\*c);
EXTERNintclass\_isdrawcommand(t\_class\*c);
EXTERNvoidclass\_domainsignalin(t\_class\*c,intonset);
EXTERNvoidclass\_set\_extern\_dir(t\_symbol\*s);
\#defineCLASS\_MAINSIGNALIN(c,type,field)\\
class\_domainsignalin(c,(char\*)(&((type\*)0)-\>field)-(char\*)0)
/\*prototypeforfunctionstosavePd'stoabinbuf\*/
typedefvoid(\*t\_savefn)(t\_gobj\*x,t\_binbuf\*b);
EXTERNvoidclass\_setsavefn(t\_class\*c,t\_savefnf);
EXTERNt\_savefnclass\_getsavefn(t\_class\*c);
EXTERNvoidobj\_saveformat(t\_object\*x,t\_binbuf\*bb);/\*addformattobb\*/
/\*prototypeforfunctionstoopenpropertiesdialogs\*/
typedefvoid(\*t\_propertiesfn)(t\_gobj\*x,struct\_glist\*glist);
EXTERNvoidclass\_setpropertiesfn(t\_class\*c,t\_propertiesfnf);
EXTERNt\_propertiesfnclass\_getpropertiesfn(t\_class\*c);
\#ifndefPD\_CLASS\_DEF
\#defineclass\_addbang(x,y)class\_addbang((x),(t\_method)(y))
\#defineclass\_addpointer(x,y)class\_addpointer((x),(t\_method)(y))
\#defineclass\_addfloat(x,y)class\_doaddfloat((x),(t\_method)(y))
\#defineclass\_addsymbol(x,y)class\_addsymbol((x),(t\_method)(y))
\#defineclass\_addlist(x,y)class\_addlist((x),(t\_method)(y))
\#defineclass\_addanything(x,y)class\_addanything((x),(t\_method)(y))
\#endif
/\*------------printing---------------------------------\*/
EXTERNvoidpost(constchar\*fmt,...);
EXTERNvoidstartpost(constchar\*fmt,...);
EXTERNvoidpoststring(constchar\*s);
EXTERNvoidpostfloat(t\_floatargf);
EXTERNvoidpostatom(intargc,t\_atom\*argv);
EXTERNvoidendpost(void);
EXTERNvoiderror(constchar\*fmt,...)ATTRIBUTE\_FORMAT\_PRINTF(1,2);
EXTERNvoidverbose(intlevel,constchar\*fmt,...)ATTRIBUTE\_FORMAT\_PRINTF(2,3);
EXTERNvoidbug(constchar\*fmt,...)ATTRIBUTE\_FORMAT\_PRINTF(1,2);
EXTERNvoidpd\_error(void\*object,constchar\*fmt,...)ATTRIBUTE\_FORMAT\_PRINTF(2,3);
EXTERNvoidlogpost(constvoid\*object,constintlevel,constchar\*fmt,...)
ATTRIBUTE\_FORMAT\_PRINTF(3,4);
EXTERNvoidsys\_logerror(constchar\*object,constchar\*s);
EXTERNvoidsys\_unixerror(constchar\*object);
EXTERNvoidsys\_ouch(void);
/\*------------systeminterfaceroutines-------------------\*/
EXTERNintsys\_isreadablefile(constchar\*name);
EXTERNintsys\_isabsolutepath(constchar\*dir);
EXTERNvoidsys\_bashfilename(constchar\*from,char\*to);
EXTERNvoidsys\_unbashfilename(constchar\*from,char\*to);
EXTERNintopen\_via\_path(constchar\*dir,constchar\*name,constchar\*ext,
char\*dirresult,char\*\*nameresult,unsignedintsize,intbin);
EXTERNintsched\_geteventno(void);
EXTERNdoublesys\_getrealtime(void);
EXTERNint(\*sys\_idlehook)(void);/\*hooktoaddidletimecomputation\*/
/\*Win32'sopen()/fopen()donothandleUTF-8filenamessoweneed
\*theseinternalversionsthathandleUTF-8filenamesthesameacross
\*allplatforms.Theyarerecommendedforuseinexternal
\*objectclassesaswellsotheyworkwithUnicodefilenamesonWindows\*/
EXTERNintsys\_open(constchar\*path,intoflag,...);
EXTERNintsys\_close(intfd);
EXTERNFILE\*sys\_fopen(constchar\*filename,constchar\*mode);
EXTERNintsys\_fclose(FILE\*stream);
/\*------------threading-------------------\*/
EXTERNvoidsys\_lock(void);
EXTERNvoidsys\_unlock(void);
EXTERNintsys\_trylock(void);
/\*---------------signals-----------------------------------\*/
typedefPD\_FLOATTYPEt\_sample;
typedefunion\_sampleint\_union{
t\_samplef;
PD\_FLOATUINTTYPEi;
}t\_sampleint\_union;
\#defineMAXLOGSIG32
\#defineMAXSIGSIZE(1\<\<MAXLOGSIG)
typedefstruct\_signal
{
ints\_n;/\*numberofpointsinthearray\*/
t\_sample\*s\_vec;/\*thearray\*/
t\_floats\_sr;/\*samplerate\*/
ints\_refcount;/\*numberoftimesused\*/
ints\_isborrowed;/\*whetherwe'regoingtoborrowourarray\*/
struct\_signal\*s\_borrowedfrom;/\*signaltoborrowitfrom\*/
struct\_signal\*s\_nextfree;/\*nextinfreelist\*/
struct\_signal\*s\_nextused;/\*nextinusedlist\*/
ints\_vecsize;/\*allocatedsizeofarrayinpoints\*/
}t\_signal;
typedeft\_int\*(\*t\_perfroutine)(t\_int\*args);
EXTERNt\_int\*plus\_perform(t\_int\*args);
EXTERNt\_int\*zero\_perform(t\_int\*args);
EXTERNt\_int\*copy\_perform(t\_int\*args);
EXTERNvoiddsp\_add\_plus(t\_sample\*in1,t\_sample\*in2,t\_sample\*out,intn);
EXTERNvoiddsp\_add\_copy(t\_sample\*in,t\_sample\*out,intn);
EXTERNvoiddsp\_add\_scalarcopy(t\_float\*in,t\_sample\*out,intn);
EXTERNvoiddsp\_add\_zero(t\_sample\*out,intn);
EXTERNintsys\_getblksize(void);
EXTERNt\_floatsys\_getsr(void);
EXTERNintsys\_get\_inchannels(void);
EXTERNintsys\_get\_outchannels(void);
EXTERNvoiddsp\_add(t\_perfroutinef,intn,...);
EXTERNvoiddsp\_addv(t\_perfroutinef,intn,t\_int\*vec);
EXTERNvoidpd\_fft(t\_float\*buf,intnpoints,intinverse);
EXTERNintilog2(intn);
EXTERNvoidmayer\_fht(t\_sample\*fz,intn);
EXTERNvoidmayer\_fft(intn,t\_sample\*real,t\_sample\*imag);
EXTERNvoidmayer\_ifft(intn,t\_sample\*real,t\_sample\*imag);
EXTERNvoidmayer\_realfft(intn,t\_sample\*real);
EXTERNvoidmayer\_realifft(intn,t\_sample\*real);
EXTERNfloat\*cos\_table;
\#defineLOGCOSTABSIZE9
\#defineCOSTABSIZE(1\<\<LOGCOSTABSIZE)
EXTERNintcanvas\_suspend\_dsp(void);
EXTERNvoidcanvas\_resume\_dsp(intoldstate);
EXTERNvoidcanvas\_update\_dsp(void);
EXTERNintcanvas\_dspstate;
/\*up/downsampling\*/
typedefstruct\_resample
{
intmethod;/\*up/downsamplingmethodID\*/
intdownsample;/\*downsamplingfactor\*/
intupsample;/\*upsamplingfactor\*/
t\_sample\*s\_vec;/\*hereweholdtheresampleddata\*/
ints\_n;
t\_sample\*coeffs;/\*coefficientsforfiltering...\*/
intcoefsize;
t\_sample\*buffer;/\*bufferforfiltering\*/
intbufsize;
}t\_resample;
EXTERNvoidresample\_init(t\_resample\*x);
EXTERNvoidresample\_free(t\_resample\*x);
EXTERNvoidresample\_dsp(t\_resample\*x,t\_sample\*in,intinsize,t\_sample\*out,intoutsize,intmethod);
EXTERNvoidresamplefrom\_dsp(t\_resample\*x,t\_sample\*in,intinsize,intoutsize,intmethod);
EXTERNvoidresampleto\_dsp(t\_resample\*x,t\_sample\*out,intinsize,intoutsize,intmethod);
/\*-----------------------utilityfunctionsforsignals--------------\*/
EXTERNt\_floatmtof(t\_float);
EXTERNt\_floatftom(t\_float);
EXTERNt\_floatrmstodb(t\_float);
EXTERNt\_floatpowtodb(t\_float);
EXTERNt\_floatdbtorms(t\_float);
EXTERNt\_floatdbtopow(t\_float);
EXTERNt\_floatq8\_sqrt(t\_float);
EXTERNt\_floatq8\_rsqrt(t\_float);
\#ifndefN32
EXTERNt\_floatqsqrt(t\_float);/\*oldnameskeptforexterncompatibility\*/
EXTERNt\_floatqrsqrt(t\_float);
\#endif
/\*---------------------data---------------------------------\*/
/\*graphicalarrays\*/
EXTERN\_STRUCT\_garray;
\#definet\_garraystruct\_garray
EXTERNt\_class\*garray\_class;
EXTERNintgarray\_getfloatarray(t\_garray\*x,int\*size,t\_float\*\*vec);
EXTERNintgarray\_getfloatwords(t\_garray\*x,int\*size,t\_word\*\*vec);
EXTERNvoidgarray\_redraw(t\_garray\*x);
EXTERNintgarray\_npoints(t\_garray\*x);
EXTERNchar\*garray\_vec(t\_garray\*x);
EXTERNvoidgarray\_resize(t\_garray\*x,t\_floatargf);/\*avoid;usethis:\*/
EXTERNvoidgarray\_resize\_long(t\_garray\*x,longn);/\*betterversion\*/
EXTERNvoidgarray\_usedindsp(t\_garray\*x);
EXTERNvoidgarray\_setsaveit(t\_garray\*x,intsaveit);
EXTERNt\_glist\*garray\_getglist(t\_garray\*x);
EXTERNt\_array\*garray\_getarray(t\_garray\*x);
EXTERNt\_class\*scalar\_class;
EXTERNt\_float\*value\_get(t\_symbol\*s);
EXTERNvoidvalue\_release(t\_symbol\*s);
EXTERNintvalue\_getfloat(t\_symbol\*s,t\_float\*f);
EXTERNintvalue\_setfloat(t\_symbol\*s,t\_floatf);
/\*-------GUIinterface-functionstosendstringstoTK---------\*/
typedefvoid(\*t\_guicallbackfn)(t\_gobj\*client,t\_glist\*glist);
EXTERNvoidsys\_vgui(char\*fmt,...);
EXTERNvoidsys\_gui(char\*s);
EXTERNvoidsys\_pretendguibytes(intn);
EXTERNvoidsys\_queuegui(void\*client,t\_glist\*glist,t\_guicallbackfnf);
EXTERNvoidsys\_unqueuegui(void\*client);
/\*dialogwindowcreationanddestruction\*/
EXTERNvoidgfxstub\_new(t\_pd\*owner,void\*key,constchar\*cmd);
EXTERNvoidgfxstub\_deleteforkey(void\*key);
externt\_class\*glob\_pdobject;/\*objecttosend"pd"messages\*/
/\*-------------Max0.26compatibility--------------------\*/
/\*thefollowingreflectsthenewwayclassesarelaidout,withtheclass
pointingtothemesslistandnotviceversa.Externsshouldn'tfeelit.\*/
typedeft\_class\*t\_externclass;
EXTERNvoidc\_extern(t\_externclass\*cls,t\_newmethodnewroutine,
t\_methodfreeroutine,t\_symbol\*name,size\_tsize,inttiny,\\
t\_atomtypearg1,...);
EXTERNvoidc\_addmess(t\_methodfn,t\_symbol\*sel,t\_atomtypearg1,...);
\#definet\_getbytesgetbytes
\#definet\_freebytesfreebytes
\#definet\_resizebytesresizebytes
\#definetypedmesspd\_typedmess
\#definevmesspd\_vmess
/\*Adefinitiontohelpguiobjectsstraddle0.34-0.35changes.Ifthisis
defined,thereisa"te\_xpix"fieldinobjects,nota"te\_xpos"asbefore:\*/
\#definePD\_USE\_TE\_XPIX
\#ifndef\_MSC\_VER/\*Microoftcompilercan'thandle"inline"function/macros\*/
\#ifdefined(\_\_i386\_\_)||defined(\_\_x86\_64\_\_)||defined(\_\_arm\_\_)
/\*atestforNANsanddenormals.Shouldonlybenecessaryoni386.\*/
\#ifPD\_FLOATSIZE==32
typedefunion
{
t\_floatf;
unsignedintui;
}t\_bigorsmall32;
staticinlineintPD\_BADFLOAT(t\_floatf)/\*malformedfloat\*/
{
t\_bigorsmall32pun;
pun.f=f;
pun.ui&=0x7f800000;
return((pun.ui==0)|(pun.ui==0x7f800000));
}
staticinlineintPD\_BIGORSMALL(t\_floatf)/\*exponentoutside(-64,64)\*/
{
t\_bigorsmall32pun;
pun.f=f;
return((pun.ui&0x20000000)==((pun.ui\>\>1)&0x20000000));
}
\#elifPD\_FLOATSIZE==64
typedefunion
{
t\_floatf;
unsignedintui[2];
}t\_bigorsmall64;
staticinlineintPD\_BADFLOAT(t\_floatf)/\*malformeddouble\*/
{
t\_bigorsmall64pun;
pun.f=f;
pun.ui[1]&=0x7ff00000;
return((pun.ui[1]==0)|(pun.ui[1]==0x7ff00000));
}
staticinlineintPD\_BIGORSMALL(t\_floatf)/\*exponentoutside(-512,512)\*/
{
t\_bigorsmall64pun;
pun.f=f;
return((pun.ui[1]&0x20000000)==((pun.ui[1]\>\>1)&0x20000000));
}
\#endif/\*PD\_FLOATSIZE\*/
\#else/\*notINTELorARM\*/
\#definePD\_BADFLOAT(f)0
\#definePD\_BIGORSMALL(f)0
\#endif
\#else/\*\_MSC\_VER\*/
\#ifPD\_FLOATSIZE==32
\#definePD\_BADFLOAT(f)((((\*(unsignedint\*)&(f))&0x7f800000)==0)||\\
(((\*(unsignedint\*)&(f))&0x7f800000)==0x7f800000))
/\*morestringenttest:anythingnotbetween1e-19and1e19inabsoluteval\*/
\#definePD\_BIGORSMALL(f)((((\*(unsignedint\*)&(f))&0x60000000)==0)||\\
(((\*(unsignedint\*)&(f))&0x60000000)==0x60000000))
\#else/\*64bits...don'tknowwhattodohere\*/
\#definePD\_BADFLOAT(f)(!(((f)\>=0)||((f)\<=0)))
\#definePD\_BIGORSMALL(f)((f)\>1e150||(f)\<-1e150\\
||(f)\>-1e-150&&(f)\<1e-150)
\#endif
\#endif/\*\_MSC\_VER\*/
/\*getversionnumberatruntime\*/
EXTERNvoidsys\_getversion(int\*major,int\*minor,int\*bugfix);
EXTERN\_STRUCT\_instancemidi;
\#definet\_instancemidistruct\_instancemidi
EXTERN\_STRUCT\_instanceinter;
\#definet\_instanceinterstruct\_instanceinter
EXTERN\_STRUCT\_instancecanvas;
\#definet\_instancecanvasstruct\_instancecanvas
EXTERN\_STRUCT\_instanceugen;
\#definet\_instanceugenstruct\_instanceugen
EXTERN\_STRUCT\_instancestuff;
\#definet\_instancestuffstruct\_instancestuff
\#ifndefPDTHREADS
\#definePDTHREADS1
\#endif
struct\_pdinstance
{
doublepd\_systime;/\*globaltimeinPdticks\*/
t\_clock\*pd\_clock\_setlist;/\*listofsetclocks\*/
t\_canvas\*pd\_canvaslist;/\*listofallrootcanvases\*/
intpd\_instanceno;/\*ordinalnumberofthisinstance\*/
t\_symbol\*\*pd\_symhash;/\*symboltablehashtable\*/
t\_instancemidi\*pd\_midi;/\*privatestuffforx\_midi.c\*/
t\_instanceinter\*pd\_inter;/\*privatestufffors\_inter.c\*/
t\_instanceugen\*pd\_ugen;/\*privatestuffford\_ugen.c\*/
t\_instancecanvas\*pd\_gui;/\*semi-privatestuffing\_canvas.h\*/
t\_instancestuff\*pd\_stuff;/\*semi-privatestuffins\_stuff.h\*/
t\_pd\*pd\_newest;/\*mostrecentlycreatedobject\*/
\#ifdefPDINSTANCE
t\_symbolpd\_s\_pointer;
t\_symbolpd\_s\_float;
t\_symbolpd\_s\_symbol;
t\_symbolpd\_s\_bang;
t\_symbolpd\_s\_list;
t\_symbolpd\_s\_anything;
t\_symbolpd\_s\_signal;
t\_symbolpd\_s\_\_N;
t\_symbolpd\_s\_\_X;
t\_symbolpd\_s\_x;
t\_symbolpd\_s\_y;
t\_symbolpd\_s\_;
\#endif
\#ifPDTHREADS
intpd\_islocked;
\#endif
};
\#definet\_pdinstancestruct\_pdinstance
EXTERNt\_pdinstancepd\_maininstance;
/\*m\_pd.c\*/
\#ifdefPDINSTANCE
EXTERNt\_pdinstance\*pdinstance\_new(void);
EXTERNvoidpd\_setinstance(t\_pdinstance\*x);
EXTERNvoidpdinstance\_free(t\_pdinstance\*x);
\#endif/\*PDINSTANCE\*/
\#ifdefined(PDTHREADS)&&defined(PDINSTANCE)
\#definePERTHREAD\_\_thread
\#else
\#definePERTHREAD
\#endif
\#ifdefPDINSTANCE
EXTERNPERTHREADt\_pdinstance\*pd\_this;
EXTERNt\_pdinstance\*\*pd\_instances;
EXTERNintpd\_ninstances;
\#else
\#definepd\_this(&pd\_maininstance)
\#endif/\*PDINSTANCE\*/
\#ifdefPDINSTANCE
\#defines\_pointer(pd\_this-\>pd\_s\_pointer)
\#defines\_float(pd\_this-\>pd\_s\_float)
\#defines\_symbol(pd\_this-\>pd\_s\_symbol)
\#defines\_bang(pd\_this-\>pd\_s\_bang)
\#defines\_list(pd\_this-\>pd\_s\_list)
\#defines\_anything(pd\_this-\>pd\_s\_anything)
\#defines\_signal(pd\_this-\>pd\_s\_signal)
\#defines\_\_N(pd\_this-\>pd\_s\_\_N)
\#defines\_\_X(pd\_this-\>pd\_s\_\_X)
\#defines\_x(pd\_this-\>pd\_s\_x)
\#defines\_y(pd\_this-\>pd\_s\_y)
\#defines\_(pd\_this-\>pd\_s\_)
\#else
EXTERNt\_symbols\_pointer,s\_float,s\_symbol,s\_bang,s\_list,s\_anything,
s\_signal,s\_\_N,s\_\_X,s\_x,s\_y,s\_;
\#endif
EXTERNt\_canvas\*pd\_getcanvaslist(void);
EXTERNintpd\_getdspstate(void);
\#ifdefined(\_LANGUAGE\_C\_PLUS\_PLUS)||defined(\_\_cplusplus)
}
\#endif
\#define\_\_m\_pd\_h\_
\#endif/\*\_\_m\_pd\_h\_\*/


